<html>
 <head>
  <meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
  <title>@DOC_TITLE@</title>
  <link href="doxygen.css" rel="stylesheet" type="text/css">
</head>
<body>

<table width="100%" height="10%" bgcolor="#FFFFFF">
  <tr>
    <td colspan="2"><p><A href=http://www.atmel.com ><img src="atmel.jpg"/ border=0></A></p><br /></td>
    <td colspan="2"> <strong><font face="Helvetica" color="#000000" size="+3">Xmega Application Note</font></strong></td>
    <td colspan="2"><p><A href=http://www.atmel.com/products/AVR><img src="AVR_logo_blue.gif"/ border=0></A></p><br /></td>
  </tr>
  <tr>
    <td colspan="6" height="1" background="blue.gif"></td>
  </tr>
</table>
<!-- Generated by Doxygen 1.5.5 -->
<h1>AC_example_window_and_interrupt.c</h1><a href="AC__example__window__and__interrupt_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/* This file has been prepared for Doxygen automatic documentation generation.*/</span>
<a name="l00059"></a>00059 <span class="preprocessor">#include "<a class="code" href="avr__compiler_8h.html" title="This file implements some macros that makes the IAR C-compiler and avr-gcc work with...">avr_compiler.h</a>"</span>
<a name="l00060"></a>00060 <span class="preprocessor">#include "<a class="code" href="ac__driver_8h.html" title="XMEGA Analog Comparator driver header file.">ac_driver.h</a>"</span>
<a name="l00061"></a>00061 
<a name="l00062"></a>00062 <span class="comment">/* The Analog comparator used in the example.*/</span>
<a name="l00063"></a><a class="code" href="AC__example__window__and__interrupt_8c.html#67d1a34c515736c571484ec2a3543da5">00063</a> <span class="preprocessor">#define AC ACA</span>
<a name="l00064"></a>00064 <span class="preprocessor"></span>
<a name="l00065"></a>00065 <span class="comment">/* Global bool that indicates if event is above window is used or not. */</span>
<a name="l00066"></a><a class="code" href="AC__example__window__and__interrupt_8c.html#228bf0f76556de36f7d49c4f3d0673bf">00066</a> <span class="keyword">volatile</span> <span class="keywordtype">bool</span> <a class="code" href="AC__example__window__and__interrupt_8c.html#228bf0f76556de36f7d49c4f3d0673bf">above</a>;
<a name="l00067"></a>00067 
<a name="l00068"></a>00068 
<a name="l00069"></a><a class="code" href="AC__example__window__and__interrupt_8c.html#840291bc02cba5474a4cb46a9b9566fe">00069</a> <span class="keywordtype">int</span> <a class="code" href="AC__example__polled_8c.html#840291bc02cba5474a4cb46a9b9566fe">main</a>(<span class="keywordtype">void</span>)
<a name="l00070"></a>00070 {
<a name="l00071"></a>00071         <span class="comment">/* Enable window mode with event on "midpoint above window". */</span>
<a name="l00072"></a>00072         <a class="code" href="ac__driver_8c.html#90d4a2827bf9e4fdaea4838045c38387" title="Enable and configure window mode and associated interrupt settings.">AC_EnableWindowMode</a>(&amp;<a class="code" href="AC__example__polled_8c.html#67d1a34c515736c571484ec2a3543da5">AC</a>, AC_WINTMODE_ABOVE_gc, AC_WINTLVL_LO_gc);
<a name="l00073"></a>00073         <a class="code" href="AC__example__window__and__interrupt_8c.html#228bf0f76556de36f7d49c4f3d0673bf">above</a> = <span class="keyword">true</span>;
<a name="l00074"></a>00074 
<a name="l00075"></a>00075         <span class="comment">/* Set up MUXes to sense pin 1 and 2, with pin 0 as midpoint. */</span>
<a name="l00076"></a>00076         <a class="code" href="ac__driver_8c.html#5fb1a1c620757d192f90f0ffa75be7d5" title="Configure MUX input settings for a comparator.">AC_ConfigMUX</a>(&amp;<a class="code" href="AC__example__polled_8c.html#67d1a34c515736c571484ec2a3543da5">AC</a>, <a class="code" href="ac__driver_8h.html#1cfd8444e5e7557aa5ad103e94089e5f0db98f7a1779ffcc822390564e533c46">ANALOG_COMPARATOR0</a>, AC_MUXPOS_PIN0_gc, AC_MUXNEG_PIN1_gc);
<a name="l00077"></a>00077         <a class="code" href="ac__driver_8c.html#5fb1a1c620757d192f90f0ffa75be7d5" title="Configure MUX input settings for a comparator.">AC_ConfigMUX</a>(&amp;<a class="code" href="AC__example__polled_8c.html#67d1a34c515736c571484ec2a3543da5">AC</a>, <a class="code" href="ac__driver_8h.html#1cfd8444e5e7557aa5ad103e94089e5f5bf6e0ba5b45b16a660a890f5602de6a">ANALOG_COMPARATOR1</a>, AC_MUXPOS_PIN0_gc, AC_MUXNEG_PIN3_gc);
<a name="l00078"></a>00078 
<a name="l00079"></a>00079 
<a name="l00080"></a>00080         <span class="comment">/* Enable both comparators in low power mode. */</span>
<a name="l00081"></a>00081         <a class="code" href="ac__driver_8c.html#576441a65ed873d1355ad4812717ed4d" title="Enable a comparator.">AC_Enable</a>(&amp;<a class="code" href="AC__example__polled_8c.html#67d1a34c515736c571484ec2a3543da5">AC</a>, <a class="code" href="ac__driver_8h.html#1cfd8444e5e7557aa5ad103e94089e5f0db98f7a1779ffcc822390564e533c46">ANALOG_COMPARATOR0</a>, <span class="keyword">false</span>);
<a name="l00082"></a>00082         <a class="code" href="ac__driver_8c.html#576441a65ed873d1355ad4812717ed4d" title="Enable a comparator.">AC_Enable</a>(&amp;<a class="code" href="AC__example__polled_8c.html#67d1a34c515736c571484ec2a3543da5">AC</a>, <a class="code" href="ac__driver_8h.html#1cfd8444e5e7557aa5ad103e94089e5f5bf6e0ba5b45b16a660a890f5602de6a">ANALOG_COMPARATOR1</a>, <span class="keyword">false</span>);
<a name="l00083"></a>00083 
<a name="l00084"></a>00084 
<a name="l00085"></a>00085         <span class="comment">/* Enable output on PORTD. */</span>
<a name="l00086"></a>00086         PORTD.DIRSET = 0xFF;
<a name="l00087"></a>00087         PORTD.OUT = 0xFF;
<a name="l00088"></a>00088 
<a name="l00089"></a>00089         <span class="comment">/* Enable PMIC interrupt level low. */</span>
<a name="l00090"></a>00090         PMIC.CTRL |= PMIC_LOLVLEX_bm;
<a name="l00091"></a>00091 
<a name="l00092"></a>00092         <span class="comment">/* Enable global interrupts. */</span>
<a name="l00093"></a>00093         sei();
<a name="l00094"></a>00094 
<a name="l00095"></a>00095         <span class="keywordflow">do</span> {
<a name="l00096"></a>00096                 <span class="comment">/* Wait for interrupts. To check the if interrupts occur, put a breakpoint in</span>
<a name="l00097"></a>00097 <span class="comment">                 * the interrupt handler.*/</span>
<a name="l00098"></a>00098                 <span class="keywordflow">if</span>( <a class="code" href="ac__driver_8c.html#f84f9dfb05fb4656169ae3f44d92abae" title="Get current state for window mode.">AC_GetWindowState</a>(&amp;<a class="code" href="AC__example__polled_8c.html#67d1a34c515736c571484ec2a3543da5">AC</a>) == AC_WSTATE_ABOVE_gc){
<a name="l00099"></a>00099                         PORTD.OUT = 0xFB;
<a name="l00100"></a>00100                 }<span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="ac__driver_8c.html#f84f9dfb05fb4656169ae3f44d92abae" title="Get current state for window mode.">AC_GetWindowState</a>(&amp;<a class="code" href="AC__example__polled_8c.html#67d1a34c515736c571484ec2a3543da5">AC</a>) == AC_WSTATE_INSIDE_gc){
<a name="l00101"></a>00101                         PORTD.OUT = 0xFD;
<a name="l00102"></a>00102                 }<span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="ac__driver_8c.html#f84f9dfb05fb4656169ae3f44d92abae" title="Get current state for window mode.">AC_GetWindowState</a>(&amp;<a class="code" href="AC__example__polled_8c.html#67d1a34c515736c571484ec2a3543da5">AC</a>) == AC_WSTATE_BELOW_gc){
<a name="l00103"></a>00103                         PORTD.OUT = 0xFE;
<a name="l00104"></a>00104                 }
<a name="l00105"></a>00105 
<a name="l00106"></a>00106         } <span class="keywordflow">while</span>(<span class="keyword">true</span>);
<a name="l00107"></a>00107 }
<a name="l00108"></a>00108 
<a name="l00109"></a>00109 
<a name="l00113"></a><a class="code" href="AC__example__window__and__interrupt_8c.html#36f9e920c393b9822b75df446fe02055">00113</a> <a class="code" href="AC__example__window__and__interrupt_8c.html#36f9e920c393b9822b75df446fe02055">ISR</a>(ACA_ACW_vect)
<a name="l00114"></a>00114 {
<a name="l00115"></a>00115         <span class="keywordflow">if</span>(<a class="code" href="AC__example__window__and__interrupt_8c.html#228bf0f76556de36f7d49c4f3d0673bf">above</a>){
<a name="l00116"></a>00116                 <span class="comment">/* Enable window mode with event on "midpoint below window". */</span>
<a name="l00117"></a>00117                 <a class="code" href="ac__driver_8c.html#90d4a2827bf9e4fdaea4838045c38387" title="Enable and configure window mode and associated interrupt settings.">AC_EnableWindowMode</a>(&amp;<a class="code" href="AC__example__polled_8c.html#67d1a34c515736c571484ec2a3543da5">AC</a>, AC_WINTMODE_BELOW_gc, AC_WINTLVL_LO_gc);
<a name="l00118"></a>00118                 <a class="code" href="AC__example__window__and__interrupt_8c.html#228bf0f76556de36f7d49c4f3d0673bf">above</a> = <span class="keyword">false</span>;
<a name="l00119"></a>00119         }<span class="keywordflow">else</span>{
<a name="l00120"></a>00120                 <span class="comment">/* Enable window mode with event on "midpoint above window". */</span>
<a name="l00121"></a>00121                 <a class="code" href="ac__driver_8c.html#90d4a2827bf9e4fdaea4838045c38387" title="Enable and configure window mode and associated interrupt settings.">AC_EnableWindowMode</a>(&amp;<a class="code" href="AC__example__polled_8c.html#67d1a34c515736c571484ec2a3543da5">AC</a>, AC_WINTMODE_ABOVE_gc, AC_WINTLVL_LO_gc);
<a name="l00122"></a>00122                 <a class="code" href="AC__example__window__and__interrupt_8c.html#228bf0f76556de36f7d49c4f3d0673bf">above</a> = <span class="keyword">true</span>;
<a name="l00123"></a>00123   }
<a name="l00124"></a>00124 }
</pre></div></div>
<html>
 <head>
  <meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
  <title>@DOC_TITLE@</title>
  <link href="doxygen.css" rel="stylesheet" type="text/css">
</head>
<body>

<table width="100%" height="10%" bgcolor="#FFFFFF">
  <tr>
    <td colspan="6" height="1" background="blue.gif"></td>
  </tr>

  <tr>
    <td colspan="6">
    <address style="align: right;"><small>
Generated on Tue Apr 22 15:13:25 2008 for AVR1302 Using the XMEGA Analog Comparator by <a href="http://www.doxygen.org/index.html"><img src="doxygen.png" alt="doxygen" align="middle" border=0></a> 1.5.5</small></address>
    </td>
  </tr>

</table>
