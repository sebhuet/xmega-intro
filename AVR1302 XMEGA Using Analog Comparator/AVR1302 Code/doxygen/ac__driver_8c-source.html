<html>
 <head>
  <meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
  <title>@DOC_TITLE@</title>
  <link href="doxygen.css" rel="stylesheet" type="text/css">
</head>
<body>

<table width="100%" height="10%" bgcolor="#FFFFFF">
  <tr>
    <td colspan="2"><p><A href=http://www.atmel.com ><img src="atmel.jpg"/ border=0></A></p><br /></td>
    <td colspan="2"> <strong><font face="Helvetica" color="#000000" size="+3">Xmega Application Note</font></strong></td>
    <td colspan="2"><p><A href=http://www.atmel.com/products/AVR><img src="AVR_logo_blue.gif"/ border=0></A></p><br /></td>
  </tr>
  <tr>
    <td colspan="6" height="1" background="blue.gif"></td>
  </tr>
</table>
<!-- Generated by Doxygen 1.5.5 -->
<h1>ac_driver.c</h1><a href="ac__driver_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/* This file has been prepared for Doxygen automatic documentation generation.*/</span>
<a name="l00066"></a>00066 <span class="preprocessor">#include "<a class="code" href="ac__driver_8h.html" title="XMEGA Analog Comparator driver header file.">ac_driver.h</a>"</span>
<a name="l00067"></a>00067 
<a name="l00076"></a><a class="code" href="ac__driver_8h.html#576441a65ed873d1355ad4812717ed4d">00076</a> <span class="keywordtype">void</span> <a class="code" href="ac__driver_8c.html#576441a65ed873d1355ad4812717ed4d" title="Enable a comparator.">AC_Enable</a>(AC_t * ac, <a class="code" href="ac__driver_8h.html#904233f7b668c5bd794c50f8873fb487">AC_COMP_t</a> comp, <span class="keywordtype">bool</span> highSpeed)
<a name="l00077"></a>00077 {
<a name="l00078"></a>00078         <span class="comment">/* Access correct registers based on which comparator submodule indicated. */</span>
<a name="l00079"></a>00079         <span class="keywordflow">if</span>(comp == 0){
<a name="l00080"></a>00080                 ac-&gt;AC0CTRL = (ac-&gt;AC0CTRL &amp; ~AC_HSMODE_bm)|
<a name="l00081"></a>00081                               (AC_ENABLE_bm | (highSpeed ? AC_HSMODE_bm : 0));
<a name="l00082"></a>00082         }<span class="keywordflow">else</span>{
<a name="l00083"></a>00083                 ac-&gt;AC1CTRL = (ac-&gt;AC1CTRL &amp; ~AC_HSMODE_bm)|
<a name="l00084"></a>00084                                   (AC_ENABLE_bm | (highSpeed ? AC_HSMODE_bm : 0));
<a name="l00085"></a>00085         }
<a name="l00086"></a>00086 }
<a name="l00087"></a>00087 
<a name="l00095"></a><a class="code" href="ac__driver_8h.html#277a9b01b5465bddcb3f85d1f23ea98e">00095</a> <span class="keywordtype">void</span> <a class="code" href="ac__driver_8c.html#277a9b01b5465bddcb3f85d1f23ea98e" title="Disable a comparator.">AC_Disable</a>(AC_t * ac, <a class="code" href="ac__driver_8h.html#904233f7b668c5bd794c50f8873fb487">AC_COMP_t</a> comp)
<a name="l00096"></a>00096 {
<a name="l00097"></a>00097         <span class="comment">/* Access correct registers based on which comparator submodule indicated. */</span>
<a name="l00098"></a>00098         <span class="keywordflow">if</span>(comp == 0){
<a name="l00099"></a>00099                 ac-&gt;AC0CTRL &amp;= ~AC_ENABLE_bm;
<a name="l00100"></a>00100         }<span class="keywordflow">else</span>{
<a name="l00101"></a>00101                 ac-&gt;AC1CTRL &amp;= ~AC_ENABLE_bm;
<a name="l00102"></a>00102         }
<a name="l00103"></a>00103 }
<a name="l00104"></a>00104 
<a name="l00105"></a>00105 
<a name="l00115"></a><a class="code" href="ac__driver_8h.html#86344ceaf248ac418a35e12dfd9aa06e">00115</a> <span class="keywordtype">void</span> <a class="code" href="ac__driver_8c.html#86344ceaf248ac418a35e12dfd9aa06e" title="Configure interrupt mode and level for a comparator.">AC_ConfigInterrupt</a>(AC_t * ac, <a class="code" href="ac__driver_8h.html#904233f7b668c5bd794c50f8873fb487">AC_COMP_t</a> comp, AC_INTMODE_t interruptMode,
<a name="l00116"></a>00116                                                 AC_INTLVL_t interruptLevel)
<a name="l00117"></a>00117 {
<a name="l00118"></a>00118         <span class="comment">/* Access correct registers based on which comparator submodule indicated. */</span>
<a name="l00119"></a>00119         <span class="keywordflow">if</span>(comp == 0){
<a name="l00120"></a>00120                 ac-&gt;AC0CTRL = (ac-&gt;AC0CTRL &amp; ~(AC_INTMODE_gm | AC_INTLVL_gm))|
<a name="l00121"></a>00121                               ((uint8_t) interruptMode | interruptLevel);
<a name="l00122"></a>00122         }<span class="keywordflow">else</span>{
<a name="l00123"></a>00123                 ac-&gt;AC1CTRL = (ac-&gt;AC1CTRL &amp; ~(AC_INTMODE_gm | AC_INTLVL_gm)) |
<a name="l00124"></a>00124                                   ((uint8_t) interruptMode | interruptLevel);
<a name="l00125"></a>00125         }
<a name="l00126"></a>00126 }
<a name="l00127"></a>00127 
<a name="l00128"></a>00128 
<a name="l00137"></a><a class="code" href="ac__driver_8h.html#ae03039f2c38da919b1ac71b150c9c1f">00137</a> <span class="keywordtype">void</span> <a class="code" href="ac__driver_8c.html#ae03039f2c38da919b1ac71b150c9c1f" title="Configure hysteresis settings for a comparator.">AC_ConfigHysteresis</a>(AC_t * ac, <a class="code" href="ac__driver_8h.html#904233f7b668c5bd794c50f8873fb487">AC_COMP_t</a> comp, AC_HYSMODE_t hysteresisMode)
<a name="l00138"></a>00138 {
<a name="l00139"></a>00139         <span class="comment">/* Access correct registers based on which comparator submodule indicated. */</span>
<a name="l00140"></a>00140         <span class="keywordflow">if</span>(comp == 0){
<a name="l00141"></a>00141                 ac-&gt;AC0CTRL = (ac-&gt;AC0CTRL &amp; ~AC_HYSMODE_gm) | hysteresisMode;
<a name="l00142"></a>00142         }<span class="keywordflow">else</span>{
<a name="l00143"></a>00143                 ac-&gt;AC1CTRL = (ac-&gt;AC1CTRL &amp; ~AC_HYSMODE_gm) | hysteresisMode;
<a name="l00144"></a>00144         }
<a name="l00145"></a>00145 }
<a name="l00146"></a>00146 
<a name="l00156"></a><a class="code" href="ac__driver_8h.html#5fb1a1c620757d192f90f0ffa75be7d5">00156</a> <span class="keywordtype">void</span> <a class="code" href="ac__driver_8c.html#5fb1a1c620757d192f90f0ffa75be7d5" title="Configure MUX input settings for a comparator.">AC_ConfigMUX</a>(AC_t * ac, <a class="code" href="ac__driver_8h.html#904233f7b668c5bd794c50f8873fb487">AC_COMP_t</a> comp, AC_MUXPOS_t pos, AC_MUXNEG_t neg)
<a name="l00157"></a>00157 {
<a name="l00158"></a>00158         <span class="comment">/* Access correct registers based on which comparator submodule indicated. */</span>
<a name="l00159"></a>00159         <span class="keywordflow">if</span>(comp == 0){
<a name="l00160"></a>00160                 ac-&gt;AC0MUXCTRL = (ac-&gt;AC0MUXCTRL &amp; ~(AC_MUXPOS_gm | AC_MUXNEG_gm)) |
<a name="l00161"></a>00161                                  ((uint8_t) pos | neg);
<a name="l00162"></a>00162         }<span class="keywordflow">else</span>{
<a name="l00163"></a>00163                 ac-&gt;AC1MUXCTRL = (ac-&gt;AC1MUXCTRL &amp; ~(AC_MUXPOS_gm | AC_MUXNEG_gm)) |
<a name="l00164"></a>00164                                      ((uint8_t) pos | neg);
<a name="l00165"></a>00165         }
<a name="l00166"></a>00166 }
<a name="l00167"></a>00167 
<a name="l00168"></a>00168 
<a name="l00178"></a><a class="code" href="ac__driver_8h.html#b69b2c8df95a3a6e4d2d43278060eb5f">00178</a> <span class="keywordtype">void</span> <a class="code" href="ac__driver_8c.html#b69b2c8df95a3a6e4d2d43278060eb5f" title="Configure the voltage scaler.">AC_ConfigVoltageScaler</a>(AC_t * ac, uint8_t scaleFactor)
<a name="l00179"></a>00179 {
<a name="l00180"></a>00180         <span class="comment">/* Scale factor gets truncated to bit field size. */</span>
<a name="l00181"></a>00181         ac-&gt;CTRLB = (ac-&gt;CTRLB &amp; ~AC_SCALEFAC_gm) |
<a name="l00182"></a>00182                     ((scaleFactor &lt;&lt; AC_SCALEFAC_bp) &amp; AC_SCALEFAC_gm);
<a name="l00183"></a>00183 }
<a name="l00184"></a>00184 
<a name="l00185"></a>00185 
<a name="l00198"></a><a class="code" href="ac__driver_8h.html#90d4a2827bf9e4fdaea4838045c38387">00198</a> <span class="keywordtype">void</span> <a class="code" href="ac__driver_8c.html#90d4a2827bf9e4fdaea4838045c38387" title="Enable and configure window mode and associated interrupt settings.">AC_EnableWindowMode</a>(AC_t * ac, AC_WINTMODE_t interruptMode,
<a name="l00199"></a>00199                          AC_WINTLVL_t interruptLevel)
<a name="l00200"></a>00200 {
<a name="l00201"></a>00201         ac-&gt;WINCTRL = (ac-&gt;WINCTRL &amp; ~(AC_WINTMODE_gm | AC_WINTLVL_gm)) |
<a name="l00202"></a>00202                       (AC_WEN_bm | interruptMode | interruptLevel);
<a name="l00203"></a>00203 }
<a name="l00204"></a>00204 
<a name="l00205"></a>00205 
<a name="l00210"></a><a class="code" href="ac__driver_8h.html#55f98be49f2cfcadd26a4fffc87c2836">00210</a> <span class="keywordtype">void</span> <a class="code" href="ac__driver_8c.html#55f98be49f2cfcadd26a4fffc87c2836" title="This function disables the window mode.">AC_DisableWindowMode</a>(AC_t * ac)
<a name="l00211"></a>00211 {
<a name="l00212"></a>00212         ac-&gt;WINCTRL = ~AC_WEN_bm;
<a name="l00213"></a>00213 }
<a name="l00214"></a>00214 
<a name="l00215"></a>00215 
<a name="l00220"></a><a class="code" href="ac__driver_8h.html#4c2bfd23f3f45a1295597a4d8fcfdf24">00220</a> <span class="keywordtype">void</span> <a class="code" href="ac__driver_8c.html#4c2bfd23f3f45a1295597a4d8fcfdf24" title="This function enables routing of comparator 0 output to pin 0.">AC_EnableComparator0_Output</a>(AC_t * ac)
<a name="l00221"></a>00221 {
<a name="l00222"></a>00222         ac-&gt;CTRLA |= AC_AC0OUT_bm;
<a name="l00223"></a>00223 }
<a name="l00224"></a>00224 
<a name="l00225"></a>00225 
<a name="l00230"></a><a class="code" href="ac__driver_8h.html#7823ffc5b6b05059d14888310693bfa8">00230</a> <span class="keywordtype">void</span> <a class="code" href="ac__driver_8c.html#7823ffc5b6b05059d14888310693bfa8" title="This function disables routing of comparator 0 output to pin 0.">AC_DisableComparator0_Output</a>(AC_t * ac)
<a name="l00231"></a>00231 {
<a name="l00232"></a>00232         ac-&gt;CTRLA &amp;= ~AC_AC0OUT_bm;
<a name="l00233"></a>00233 }
<a name="l00234"></a>00234 
<a name="l00235"></a>00235 
<a name="l00245"></a><a class="code" href="ac__driver_8h.html#cde7775fd96fe9b8c2478c954f23ea0a">00245</a> uint8_t <a class="code" href="ac__driver_8c.html#cde7775fd96fe9b8c2478c954f23ea0a" title="Get current state of one comparator.">AC_GetComparatorState</a>(AC_t * ac, <a class="code" href="ac__driver_8h.html#904233f7b668c5bd794c50f8873fb487">AC_COMP_t</a> comp)
<a name="l00246"></a>00246 {
<a name="l00247"></a>00247         uint8_t state = 0;
<a name="l00248"></a>00248 
<a name="l00249"></a>00249         <span class="comment">/* Access correct bits based on which comparator submodule indicated. */</span>
<a name="l00250"></a>00250         <span class="keywordflow">if</span>(comp == 0){
<a name="l00251"></a>00251                 state = ac-&gt;STATUS &amp; AC_AC0STATE_bm;
<a name="l00252"></a>00252         }<span class="keywordflow">else</span> <span class="keywordflow">if</span>(comp == 1){
<a name="l00253"></a>00253                 state = ac-&gt;STATUS &amp; AC_AC1STATE_bm;
<a name="l00254"></a>00254         }<span class="keywordflow">else</span>{
<a name="l00255"></a>00255 
<a name="l00256"></a>00256         }
<a name="l00257"></a>00257 
<a name="l00258"></a>00258         <span class="keywordflow">return</span> state;
<a name="l00259"></a>00259 }
<a name="l00260"></a>00260 
<a name="l00261"></a>00261 
<a name="l00272"></a><a class="code" href="ac__driver_8h.html#f84f9dfb05fb4656169ae3f44d92abae">00272</a> uint8_t <a class="code" href="ac__driver_8c.html#f84f9dfb05fb4656169ae3f44d92abae" title="Get current state for window mode.">AC_GetWindowState</a>(AC_t * ac)
<a name="l00273"></a>00273 {
<a name="l00274"></a>00274         <span class="keywordflow">return</span> (ac-&gt;STATUS &amp; AC_WSTATE_gm);
<a name="l00275"></a>00275 }
<a name="l00276"></a>00276 
<a name="l00277"></a>00277 
<a name="l00286"></a><a class="code" href="ac__driver_8h.html#f93f4784d3f4387d3767a755ae4de257">00286</a> <span class="keywordtype">void</span> <a class="code" href="ac__driver_8c.html#f93f4784d3f4387d3767a755ae4de257" title="Wait for event from a comparator.">AC_WaitForComparator_Blocking</a>(AC_t * ac, <a class="code" href="ac__driver_8h.html#904233f7b668c5bd794c50f8873fb487">AC_COMP_t</a> comp)
<a name="l00287"></a>00287 {
<a name="l00288"></a>00288         <span class="comment">/* Access correct bits based on which comparator submodule indicated.*/</span>
<a name="l00289"></a>00289         <span class="keywordflow">if</span>(comp == 0){
<a name="l00290"></a>00290                 <span class="comment">/* Wait for interrupt flag to be set and clear it. */</span>
<a name="l00291"></a>00291                 <span class="keywordflow">do</span> {} <span class="keywordflow">while</span> ((ac-&gt;STATUS &amp; AC_AC0IF_bm) == 0);
<a name="l00292"></a>00292                 ac-&gt;STATUS = AC_AC0IF_bm;
<a name="l00293"></a>00293         }<span class="keywordflow">else</span>{
<a name="l00294"></a>00294                 <span class="comment">/* Wait for interrupt flag to be set and clear it. */</span>
<a name="l00295"></a>00295                 <span class="keywordflow">do</span> {} <span class="keywordflow">while</span> ((ac-&gt;STATUS &amp; AC_AC1IF_bm) == 0);
<a name="l00296"></a>00296                 ac-&gt;STATUS = AC_AC1IF_bm;
<a name="l00297"></a>00297         }
<a name="l00298"></a>00298 }
<a name="l00299"></a>00299 
<a name="l00300"></a>00300 
<a name="l00308"></a><a class="code" href="ac__driver_8h.html#e5d0fac53810e0a536266c9e3399f89a">00308</a> <span class="keywordtype">void</span> <a class="code" href="ac__driver_8c.html#e5d0fac53810e0a536266c9e3399f89a" title="Wait for window mode event.">AC_WaitForWindow_Blocking</a>(AC_t * ac)
<a name="l00309"></a>00309 {
<a name="l00310"></a>00310         <span class="comment">/* Wait for interrupt flag to be set and clear it. */</span>
<a name="l00311"></a>00311         <span class="keywordflow">do</span> {} <span class="keywordflow">while</span> ((ac-&gt;STATUS &amp; AC_WIF_bm) == 0);
<a name="l00312"></a>00312         ac-&gt;STATUS = AC_WIF_bm;
<a name="l00313"></a>00313 }
<a name="l00314"></a>00314 
</pre></div></div>
<html>
 <head>
  <meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
  <title>@DOC_TITLE@</title>
  <link href="doxygen.css" rel="stylesheet" type="text/css">
</head>
<body>

<table width="100%" height="10%" bgcolor="#FFFFFF">
  <tr>
    <td colspan="6" height="1" background="blue.gif"></td>
  </tr>

  <tr>
    <td colspan="6">
    <address style="align: right;"><small>
Generated on Tue Apr 22 15:13:25 2008 for AVR1302 Using the XMEGA Analog Comparator by <a href="http://www.doxygen.org/index.html"><img src="doxygen.png" alt="doxygen" align="middle" border=0></a> 1.5.5</small></address>
    </td>
  </tr>

</table>
