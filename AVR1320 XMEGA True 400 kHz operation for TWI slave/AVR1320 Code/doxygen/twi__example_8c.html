<html>
 <head>
  <meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
  <title>@DOC_TITLE@</title>
  <link href="doxygen.css" rel="stylesheet" type="text/css">
</head>
<body>

<table width="100%" height="10%" bgcolor="#FFFFFF">
  <tr>
    <td colspan="2"><p><A href=http://www.atmel.com ><img src="atmel.jpg"/ border=0></A></p><br /></td>
    <td colspan="2"> <strong><font face="Helvetica" color="#000000" size="+3">Xmega Application Note</font></strong></td>
    <td colspan="2"><p><A href=http://www.atmel.com/products/AVR><img src="AVR_logo_blue.gif"/ border=0></A></p><br /></td>
  </tr>
  <tr>
    <td colspan="6" height="1" background="blue.gif"></td>
  </tr>
</table>
<!-- Generated by Doxygen 1.5.8 -->
<div class="contents">
<h1>twi_example.c File Reference</h1>XMEGA TWI slave example source file.  
<a href="#_details">More...</a>
<p>
<code>#include &quot;<a class="el" href="avr__compiler_8h-source.html">avr_compiler.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="twi__slave__driver_8h-source.html">twi_slave_driver.h</a>&quot;</code><br>

<p>
<div class="dynheader">
Include dependency graph for twi_example.c:</div>
<div class="dynsection">
<p><center><img src="twi__example_8c__incl.png" border="0" usemap="#twi_example.c_map" alt=""></center>
<map name="twi_example.c_map">
<area shape="rect" href="avr__compiler_8h.html" title="AVR compiler." alt="" coords="76,155,185,181"><area shape="rect" href="twi__slave__driver_8h.html" title="XMEGA TWI slave driver header file." alt="" coords="117,80,248,107"></map>
</div>

<p>
<a href="twi__example_8c-source.html">Go to the source code of this file.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="twi__example_8c.html#7206e1a3cf67c8d51a3732252593a0fb">NUM_BYTES</a>&nbsp;&nbsp;&nbsp;8</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="twi__example_8c.html#e2f0ff6faf548539a21b93a034e278e8">SLAVE_ADDRESS</a>&nbsp;&nbsp;&nbsp;0x51</td></tr>

<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="twi__example_8c.html#0734971b2c3847c6e527957b3c331ebb">ISR</a> (PORTC_INT0_vect)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="twi__example_8c.html#840291bc02cba5474a4cb46a9b9566fe">main</a> (void)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="twi__example_8c.html#efb04ec5f3a4794c210a99bb96385570">TWI_process</a> (<a class="el" href="structTWI__Slave.html">TWI_Slave_t</a> *twi)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Process TWI command.  <a href="#efb04ec5f3a4794c210a99bb96385570"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="twi__example_8c.html#9b34519fcb79c06eb895c65a2f0aac61">TWIC_SlaveProcessData</a> (void)</td></tr>

<tr><td colspan="2"><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">uint8_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="twi__example_8c.html#86050c37e24ac25f0dfbc8790e72147b">twic_ctrla_reg</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">uint8_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="twi__example_8c.html#c90975085fa1827f3d0b90d4c7df899b">twic_ctrlb_reg</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">uint8_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="twi__example_8c.html#2982dac04be2fac74a31fb4607a947c8">twic_data_reg</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">uint8_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="twi__example_8c.html#9b0180363d5eb61e75e9a336b8196ecd">twic_status_reg</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="structTWI__Slave.html">TWI_Slave_t</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="twi__example_8c.html#3701bb8856f53ab26fc694201fde9033">twiSlave</a></td></tr>

</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
XMEGA TWI slave example source file. 
<p>
<dl class="user" compact><dt><b>Application note:</b></dt><dd>AVR1320: True 400kHz operation for TWI slave</dd></dl>
<dl class="user" compact><dt><b>Documentation</b></dt><dd>For comprehensive code documentation, supported compilers, compiler settings and supported devices see readme.html</dd></dl>
<dl class="author" compact><dt><b>Author:</b></dt><dd>Atmel Corporation: <a href="http://www.atmel.com">http://www.atmel.com</a> <br>
 Support email: <a href="mailto:avr@atmel.com">avr@atmel.com</a></dd></dl>
Copyright (c) 2009 Atmel Corporation. All rights reserved.<p>
Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:<p>
1. Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.<p>
2. Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.<p>
3. The name of Atmel may not be used to endorse or promote products derived from this software without specific prior written permission.<p>
4. This software may only be redistributed and used in connection with an Atmel AVR product.<p>
THIS SOFTWARE IS PROVIDED BY ATMEL "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT ARE EXPRESSLY AND SPECIFICALLY DISCLAIMED. IN NO EVENT SHALL ATMEL BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE. 
<p>Definition in file <a class="el" href="twi__example_8c-source.html">twi_example.c</a>.</p>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="7206e1a3cf67c8d51a3732252593a0fb"></a><!-- doxytag: member="twi_example.c::NUM_BYTES" ref="7206e1a3cf67c8d51a3732252593a0fb" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define NUM_BYTES&nbsp;&nbsp;&nbsp;8          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Defining number of bytes in buffer. 
<p>Definition at line <a class="el" href="twi__example_8c-source.html#l00067">67</a> of file <a class="el" href="twi__example_8c-source.html">twi_example.c</a>.</p>

</div>
</div><p>
<a class="anchor" name="e2f0ff6faf548539a21b93a034e278e8"></a><!-- doxytag: member="twi_example.c::SLAVE_ADDRESS" ref="e2f0ff6faf548539a21b93a034e278e8" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SLAVE_ADDRESS&nbsp;&nbsp;&nbsp;0x51          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Defining an example slave address.<p>
ATxmega128A1 TWI address 
<p>Definition at line <a class="el" href="twi__example_8c-source.html#l00064">64</a> of file <a class="el" href="twi__example_8c-source.html">twi_example.c</a>.</p>

<p>Referenced by <a class="el" href="twi__example_8c-source.html#l00095">main()</a>.</p>

</div>
</div><p>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="0734971b2c3847c6e527957b3c331ebb"></a><!-- doxytag: member="twi_example.c::ISR" ref="0734971b2c3847c6e527957b3c331ebb" args="(PORTC_INT0_vect)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">ISR           </td>
          <td>(</td>
          <td class="paramtype">PORTC_INT0_vect&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
/brief TWI Slave Process Data Interrupt<p>
ISR to process TWI 
<p>Definition at line <a class="el" href="twi__example_8c-source.html#l00129">129</a> of file <a class="el" href="twi__example_8c-source.html">twi_example.c</a>.</p>

<p>References <a class="el" href="twi__slave__driver_8c-source.html#l00116">TWI_process()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00130"></a>00130 {
<a name="l00131"></a>00131    PORTC.INTFLAGS |= PORT_INT0IF_bm;
<a name="l00132"></a>00132    PORTC.INTCTRL = PORT_INT0LVL_OFF_gc;
<a name="l00133"></a>00133 
<a name="l00134"></a>00134    <a class="code" href="twi__example_8c.html#efb04ec5f3a4794c210a99bb96385570" title="Process TWI command.">TWI_process</a>(&amp;<a class="code" href="twi__example_8c.html#3701bb8856f53ab26fc694201fde9033">twiSlave</a>);
<a name="l00135"></a>00135 }
</pre></div>
<p>

<p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dynsection">
<p><center><img src="twi__example_8c_0734971b2c3847c6e527957b3c331ebb_cgraph.png" border="0" usemap="#twi__example_8c_0734971b2c3847c6e527957b3c331ebb_cgraph_map" alt=""></center>
<map name="twi__example_8c_0734971b2c3847c6e527957b3c331ebb_cgraph_map">
<area shape="rect" href="twi__example_8c.html#efb04ec5f3a4794c210a99bb96385570" title="Process TWI command." alt="" coords="100,81,201,108"><area shape="rect" href="twi__slave__driver_8c.html#da072f7590f8a8c4b158891b0dcd33ec" title="TWI address match interrupt handler." alt="" coords="251,5,472,32"><area shape="rect" href="twi__slave__driver_8c.html#3aad0def0561cf7bbeb8fad7ebf4fb7f" title="TWI data interrupt handler." alt="" coords="280,56,443,83"><area shape="rect" href="twi__slave__driver_8c.html#b9b7fbb48160ccaf6faf33bb9c98396f" title="TWI transaction finished function." alt="" coords="737,107,945,133"><area shape="rect" href="twi__slave__driver_8c.html#9036345d0182f2e647d9145fa710e20b" title="TWI stop condition interrupt handler." alt="" coords="523,157,685,184"><area shape="rect" href="twi__slave__driver_8c.html#d48293bf279707867535d057473f18b7" title="TWI slave read interrupt handler." alt="" coords="521,5,687,32"><area shape="rect" href="twi__slave__driver_8c.html#772668c5ff7c19f0fab6c9f88ed0a5dd" title="TWI slave write interrupt handler." alt="" coords="521,56,687,83"></map>
</div>

</div>
</div><p>
<a class="anchor" name="840291bc02cba5474a4cb46a9b9566fe"></a><!-- doxytag: member="twi_example.c::main" ref="840291bc02cba5474a4cb46a9b9566fe" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int main           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
/brief main function<p>
Example code of TWI application in slave mode with no clock stretching at 400kHz. The data received from the master are stored in receive buffer and then copied in send buffer. 
<p>Definition at line <a class="el" href="twi__example_8c-source.html#l00095">95</a> of file <a class="el" href="twi__example_8c-source.html">twi_example.c</a>.</p>

<p>References <a class="el" href="twi__example_8c-source.html#l00064">SLAVE_ADDRESS</a>, <a class="el" href="twi__slave__driver_8c-source.html#l00068">TWI_SlaveInitializeDriver()</a>, <a class="el" href="twi__slave__driver_8c-source.html#l00099">TWI_SlaveInitializeModule()</a>, and <a class="el" href="twi__example_8c-source.html#l00077">TWIC_SlaveProcessData()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00096"></a>00096 {
<a name="l00097"></a>00097    <span class="comment">/* Initialize PORTF for debug on STK600 */</span>
<a name="l00098"></a>00098    PORTF.DIRSET = 0xFF;
<a name="l00099"></a>00099         
<a name="l00100"></a>00100    <span class="comment">// Configure LEDs for STK600</span>
<a name="l00101"></a>00101    PORTCFG.MPCMASK = 0xFF; <span class="comment">// Configure several PINxCTRL registers at the same time</span>
<a name="l00102"></a>00102    PORTF.PIN0CTRL = PORT_INVEN_bm; <span class="comment">// Invert input to turn the leds on when port output value is 1</span>
<a name="l00103"></a>00103    PORTF.OUT = 0x00;
<a name="l00104"></a>00104    
<a name="l00105"></a>00105    <span class="comment">/* Set up interrupt mask on SCL pin */</span>
<a name="l00106"></a>00106    PORTC.INT0MASK = PIN1_bm;
<a name="l00107"></a>00107         
<a name="l00108"></a>00108    <span class="comment">/* Initialize TWI slave. */</span>
<a name="l00109"></a>00109    <a class="code" href="twi__slave__driver_8c.html#14b9327d32373a2481e23bec041cbd7e" title="Initalizes TWI slave driver structure.">TWI_SlaveInitializeDriver</a>(&amp;<a class="code" href="twi__example_8c.html#3701bb8856f53ab26fc694201fde9033">twiSlave</a>, &amp;TWIC, <a class="code" href="twi__example_8c.html#9b34519fcb79c06eb895c65a2f0aac61">TWIC_SlaveProcessData</a>);
<a name="l00110"></a>00110    <a class="code" href="twi__slave__driver_8c.html#7516e604cb0aacddd8d1016a54039752" title="Initialize the TWI module.">TWI_SlaveInitializeModule</a>(&amp;<a class="code" href="twi__example_8c.html#3701bb8856f53ab26fc694201fde9033">twiSlave</a>,
<a name="l00111"></a>00111                              <a class="code" href="twi__example_8c.html#e2f0ff6faf548539a21b93a034e278e8">SLAVE_ADDRESS</a>,
<a name="l00112"></a>00112                              TWI_SLAVE_INTLVL_HI_gc);   
<a name="l00113"></a>00113    TWIC.SLAVE.CTRLA |= TWI_SLAVE_SMEN_bm;
<a name="l00114"></a>00114         
<a name="l00115"></a>00115    <span class="comment">/* interrupt level. */</span>
<a name="l00116"></a>00116    PMIC.CTRL |= PMIC_HILVLEN_bm | PMIC_MEDLVLEN_bm;
<a name="l00117"></a>00117    sei();
<a name="l00118"></a>00118         
<a name="l00119"></a>00119    <span class="keywordflow">do</span>{
<a name="l00120"></a>00120       <span class="comment">//User application        </span>
<a name="l00121"></a>00121    }<span class="keywordflow">while</span> (1);  
<a name="l00122"></a>00122 }
</pre></div>
<p>

<p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dynsection">
<p><center><img src="twi__example_8c_840291bc02cba5474a4cb46a9b9566fe_cgraph.png" border="0" usemap="#twi__example_8c_840291bc02cba5474a4cb46a9b9566fe_cgraph_map" alt=""></center>
<map name="twi__example_8c_840291bc02cba5474a4cb46a9b9566fe_cgraph_map">
<area shape="rect" href="twi__slave__driver_8c.html#14b9327d32373a2481e23bec041cbd7e" title="Initalizes TWI slave driver structure." alt="" coords="109,31,280,57"><area shape="rect" href="twi__slave__driver_8c.html#7516e604cb0aacddd8d1016a54039752" title="Initialize the TWI module." alt="" coords="105,81,284,108"><area shape="rect" href="twi__example_8c.html#9b34519fcb79c06eb895c65a2f0aac61" title="TWIC_SlaveProcessData" alt="" coords="108,132,281,159"><area shape="rect" href="clksys__driver_8c.html#31b1ca1994b6a687974a119d1ad8008c" title="This function disables the selected oscillator." alt="" coords="391,5,516,32"><area shape="rect" href="clksys__driver_8c.html#1e46c4a8f01a83d4e4747d32d113e7e2" title="This function selects the main system clock source." alt="" coords="335,56,572,83"><area shape="rect" href="clksys__driver_8c.html#ad4e162434c2cc7e0087bbc0ddfe266c" title="CCP write helper function written in assembly." alt="" coords="623,56,703,83"></map>
</div>

</div>
</div><p>
<a class="anchor" name="efb04ec5f3a4794c210a99bb96385570"></a><!-- doxytag: member="twi_example.c::TWI_process" ref="efb04ec5f3a4794c210a99bb96385570" args="(TWI_Slave_t *twi)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TWI_process           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structTWI__Slave.html">TWI_Slave_t</a> *&nbsp;</td>
          <td class="paramname"> <em>twi</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Process TWI command. 
<p>
This function is called out of ISR to process TWI command.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>twi</em>&nbsp;</td><td>The TWI_Slave_t struct instance. </td></tr>
  </table>
</dl>

<p>
&lt; Clear ACKACT 
<p>Definition at line <a class="el" href="twi__slave__driver_8c-source.html#l00116">116</a> of file <a class="el" href="twi__slave__driver_8c-source.html">twi_slave_driver.c</a>.</p>

<p>References <a class="el" href="twi__slave__driver_8h-source.html#l00081">TWI_Slave::bytesReceived</a>, <a class="el" href="twi__slave__driver_8h-source.html#l00082">TWI_Slave::bytesSent</a>, <a class="el" href="twi__slave__driver_8h-source.html#l00077">TWI_Slave::interface</a>, <a class="el" href="twi__slave__driver_8h-source.html#l00084">TWI_Slave::result</a>, <a class="el" href="twi__slave__driver_8h-source.html#l00083">TWI_Slave::status</a>, <a class="el" href="twi__slave__driver_8c-source.html#l00162">TWI_SlaveAddressMatchHandler()</a>, <a class="el" href="twi__slave__driver_8c-source.html#l00199">TWI_SlaveDataHandler()</a>, <a class="el" href="twi__slave__driver_8c-source.html#l00182">TWI_SlaveStopHandler()</a>, <a class="el" href="twi__slave__driver_8c-source.html#l00274">TWI_SlaveTransactionFinished()</a>, <a class="el" href="twi__example_8c-source.html#l00057">twic_status_reg</a>, <a class="el" href="twi__slave__driver_8h-source.html#l00060">TWIS_RESULT_BUS_ERROR</a>, <a class="el" href="twi__slave__driver_8h-source.html#l00061">TWIS_RESULT_FAIL</a>, <a class="el" href="twi__slave__driver_8h-source.html#l00059">TWIS_RESULT_TRANSMIT_COLLISION</a>, and <a class="el" href="twi__slave__driver_8h-source.html#l00051">TWIS_STATUS_READY</a>.</p>

<p>Referenced by <a class="el" href="twi__example_8c-source.html#l00129">ISR()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00117"></a>00117 {
<a name="l00118"></a>00118    <span class="comment">//static uint8_t sent_NACK = 0;      //!&lt; Holds whether NACK has been transmitted</span>
<a name="l00119"></a>00119    uint8_t currentStatus;
<a name="l00120"></a>00120    currentStatus = <a class="code" href="twi__example_8c.html#9b0180363d5eb61e75e9a336b8196ecd">twic_status_reg</a>;
<a name="l00121"></a>00121 
<a name="l00122"></a>00122    twi-&gt;<a class="code" href="structTWI__Slave.html#77840b2d29e959498be84cc3bec0cd22">interface</a>-&gt;SLAVE.CTRLB &amp;= ~TWI_SLAVE_ACKACT_bm; 
<a name="l00123"></a>00123 
<a name="l00124"></a>00124    <span class="comment">/* If bus error. */</span>
<a name="l00125"></a>00125    <span class="keywordflow">if</span> (currentStatus &amp; TWI_SLAVE_BUSERR_bm) {
<a name="l00126"></a>00126       twi-&gt;<a class="code" href="structTWI__Slave.html#35d1088ea403c9811886cc3a454d20ff">bytesReceived</a> = 0;
<a name="l00127"></a>00127       twi-&gt;<a class="code" href="structTWI__Slave.html#e44adb76a49e3ecca8542d10a1d453f8">bytesSent</a> = 0;
<a name="l00128"></a>00128       twi-&gt;<a class="code" href="structTWI__Slave.html#38f52b1274d890275ae25f68d289c8d8">result</a> = <a class="code" href="twi__slave__driver_8h.html#e4209c180fb129f523c8ae18315efc12ce631c3c42041eecb31faad3d44ccc02">TWIS_RESULT_BUS_ERROR</a>;
<a name="l00129"></a>00129       twi-&gt;<a class="code" href="structTWI__Slave.html#f5c33c2e305df38d283d66cdd92d8024">status</a> = <a class="code" href="twi__slave__driver_8h.html#29a0dd867f9750813df434b03a538243">TWIS_STATUS_READY</a>;
<a name="l00130"></a>00130    }
<a name="l00131"></a>00131    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (currentStatus &amp; TWI_SLAVE_COLL_bm) {
<a name="l00132"></a>00132       <span class="comment">/* If transmit collision. */</span>
<a name="l00133"></a>00133       twi-&gt;<a class="code" href="structTWI__Slave.html#35d1088ea403c9811886cc3a454d20ff">bytesReceived</a> = 0;
<a name="l00134"></a>00134       twi-&gt;<a class="code" href="structTWI__Slave.html#e44adb76a49e3ecca8542d10a1d453f8">bytesSent</a> = 0;
<a name="l00135"></a>00135       twi-&gt;<a class="code" href="structTWI__Slave.html#38f52b1274d890275ae25f68d289c8d8">result</a> = <a class="code" href="twi__slave__driver_8h.html#e4209c180fb129f523c8ae18315efc12dbbf8ba327cbb8f83185c7729b7ea4f2">TWIS_RESULT_TRANSMIT_COLLISION</a>;
<a name="l00136"></a>00136       twi-&gt;<a class="code" href="structTWI__Slave.html#f5c33c2e305df38d283d66cdd92d8024">status</a> = <a class="code" href="twi__slave__driver_8h.html#29a0dd867f9750813df434b03a538243">TWIS_STATUS_READY</a>;
<a name="l00137"></a>00137    }
<a name="l00138"></a>00138    <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((currentStatus &amp; TWI_SLAVE_APIF_bm) &amp;&amp; (currentStatus &amp; TWI_SLAVE_AP_bm)) {
<a name="l00139"></a>00139       <span class="comment">/* If address match. */</span>
<a name="l00140"></a>00140       <a class="code" href="twi__slave__driver_8c.html#da072f7590f8a8c4b158891b0dcd33ec" title="TWI address match interrupt handler.">TWI_SlaveAddressMatchHandler</a>(twi);        
<a name="l00141"></a>00141    }
<a name="l00142"></a>00142    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (currentStatus &amp; TWI_SLAVE_APIF_bm) {
<a name="l00143"></a>00143       <span class="comment">/* If stop (only enabled through slave read transaction). */</span>        
<a name="l00144"></a>00144       <a class="code" href="twi__slave__driver_8c.html#9036345d0182f2e647d9145fa710e20b" title="TWI stop condition interrupt handler.">TWI_SlaveStopHandler</a>(twi);
<a name="l00145"></a>00145    }
<a name="l00146"></a>00146    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (currentStatus &amp; TWI_SLAVE_DIF_bm) {
<a name="l00147"></a>00147       <span class="comment">/* If data interrupt. */</span>     
<a name="l00148"></a>00148       <a class="code" href="twi__slave__driver_8c.html#3aad0def0561cf7bbeb8fad7ebf4fb7f" title="TWI data interrupt handler.">TWI_SlaveDataHandler</a>(twi);
<a name="l00149"></a>00149    }
<a name="l00150"></a>00150    <span class="keywordflow">else</span> {
<a name="l00151"></a>00151       <span class="comment">/* If unexpected state. */</span>
<a name="l00152"></a>00152       <a class="code" href="twi__slave__driver_8c.html#b9b7fbb48160ccaf6faf33bb9c98396f" title="TWI transaction finished function.">TWI_SlaveTransactionFinished</a>(twi, <a class="code" href="twi__slave__driver_8h.html#e4209c180fb129f523c8ae18315efc12f3b4529c8dce92f5902d00a0cc6209ec">TWIS_RESULT_FAIL</a>);
<a name="l00153"></a>00153    }
<a name="l00154"></a>00154 }
</pre></div>
<p>

<p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dynsection">
<p><center><img src="twi__example_8c_efb04ec5f3a4794c210a99bb96385570_cgraph.png" border="0" usemap="#twi__example_8c_efb04ec5f3a4794c210a99bb96385570_cgraph_map" alt=""></center>
<map name="twi__example_8c_efb04ec5f3a4794c210a99bb96385570_cgraph_map">
<area shape="rect" href="twi__slave__driver_8c.html#da072f7590f8a8c4b158891b0dcd33ec" title="TWI address match interrupt handler." alt="" coords="157,5,379,32"><area shape="rect" href="twi__slave__driver_8c.html#3aad0def0561cf7bbeb8fad7ebf4fb7f" title="TWI data interrupt handler." alt="" coords="187,56,349,83"><area shape="rect" href="twi__slave__driver_8c.html#b9b7fbb48160ccaf6faf33bb9c98396f" title="TWI transaction finished function." alt="" coords="644,107,852,133"><area shape="rect" href="twi__slave__driver_8c.html#9036345d0182f2e647d9145fa710e20b" title="TWI stop condition interrupt handler." alt="" coords="429,157,592,184"><area shape="rect" href="twi__slave__driver_8c.html#d48293bf279707867535d057473f18b7" title="TWI slave read interrupt handler." alt="" coords="428,5,593,32"><area shape="rect" href="twi__slave__driver_8c.html#772668c5ff7c19f0fab6c9f88ed0a5dd" title="TWI slave write interrupt handler." alt="" coords="428,56,593,83"></map>
</div>

</div>
</div><p>
<a class="anchor" name="9b34519fcb79c06eb895c65a2f0aac61"></a><!-- doxytag: member="twi_example.c::TWIC_SlaveProcessData" ref="9b34519fcb79c06eb895c65a2f0aac61" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TWIC_SlaveProcessData           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
/brief Process data from master<p>
Simple function that invert the received value in the sendbuffer. This function is used in the driver and passed on as a pointer to the driver. 
<p>Definition at line <a class="el" href="twi__example_8c-source.html#l00077">77</a> of file <a class="el" href="twi__example_8c-source.html">twi_example.c</a>.</p>

<p>References <a class="el" href="twi__slave__driver_8h-source.html#l00081">TWI_Slave::bytesReceived</a>, <a class="el" href="twi__slave__driver_8h-source.html#l00079">TWI_Slave::receivedData</a>, <a class="el" href="twi__slave__driver_8h-source.html#l00080">TWI_Slave::sendData</a>, and <a class="el" href="twi__example_8c-source.html#l00060">twic_data_reg</a>.</p>

<p>Referenced by <a class="el" href="twi__example_8c-source.html#l00095">main()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00078"></a>00078 {
<a name="l00079"></a>00079    PORTF.OUT=<a class="code" href="twi__example_8c.html#3701bb8856f53ab26fc694201fde9033">twiSlave</a>.<a class="code" href="structTWI__Slave.html#8c205728fdea8bcaeaa0f6f889d83d4d">receivedData</a>[<a class="code" href="twi__example_8c.html#3701bb8856f53ab26fc694201fde9033">twiSlave</a>.<a class="code" href="structTWI__Slave.html#35d1088ea403c9811886cc3a454d20ff">bytesReceived</a>];
<a name="l00080"></a>00080    uint8_t recvData = <a class="code" href="twi__example_8c.html#3701bb8856f53ab26fc694201fde9033">twiSlave</a>.<a class="code" href="structTWI__Slave.html#8c205728fdea8bcaeaa0f6f889d83d4d">receivedData</a>[<a class="code" href="twi__example_8c.html#3701bb8856f53ab26fc694201fde9033">twiSlave</a>.<a class="code" href="structTWI__Slave.html#35d1088ea403c9811886cc3a454d20ff">bytesReceived</a>];
<a name="l00081"></a>00081    <a class="code" href="twi__example_8c.html#3701bb8856f53ab26fc694201fde9033">twiSlave</a>.<a class="code" href="structTWI__Slave.html#ac95534c65dbda49b778a3a05456682d">sendData</a>[<a class="code" href="twi__example_8c.html#3701bb8856f53ab26fc694201fde9033">twiSlave</a>.<a class="code" href="structTWI__Slave.html#35d1088ea403c9811886cc3a454d20ff">bytesReceived</a>] = recvData;
<a name="l00082"></a>00082 
<a name="l00083"></a>00083    <span class="comment">//init first byte to write</span>
<a name="l00084"></a>00084    <a class="code" href="twi__example_8c.html#2982dac04be2fac74a31fb4607a947c8">twic_data_reg</a> =  <a class="code" href="twi__example_8c.html#3701bb8856f53ab26fc694201fde9033">twiSlave</a>.<a class="code" href="structTWI__Slave.html#ac95534c65dbda49b778a3a05456682d">sendData</a>[0];
<a name="l00085"></a>00085 }
</pre></div>
<p>

</div>
</div><p>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="86050c37e24ac25f0dfbc8790e72147b"></a><!-- doxytag: member="twi_example.c::twic_ctrla_reg" ref="86050c37e24ac25f0dfbc8790e72147b" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t <a class="el" href="twi__example_8c.html#86050c37e24ac25f0dfbc8790e72147b">twic_ctrla_reg</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="twi__example_8c-source.html#l00058">58</a> of file <a class="el" href="twi__example_8c-source.html">twi_example.c</a>.</p>

</div>
</div><p>
<a class="anchor" name="c90975085fa1827f3d0b90d4c7df899b"></a><!-- doxytag: member="twi_example.c::twic_ctrlb_reg" ref="c90975085fa1827f3d0b90d4c7df899b" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t <a class="el" href="twi__example_8c.html#c90975085fa1827f3d0b90d4c7df899b">twic_ctrlb_reg</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="twi__example_8c-source.html#l00059">59</a> of file <a class="el" href="twi__example_8c-source.html">twi_example.c</a>.</p>

</div>
</div><p>
<a class="anchor" name="2982dac04be2fac74a31fb4607a947c8"></a><!-- doxytag: member="twi_example.c::twic_data_reg" ref="2982dac04be2fac74a31fb4607a947c8" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t <a class="el" href="twi__slave__driver_8c.html#2982dac04be2fac74a31fb4607a947c8">twic_data_reg</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="twi__example_8c-source.html#l00060">60</a> of file <a class="el" href="twi__example_8c-source.html">twi_example.c</a>.</p>

<p>Referenced by <a class="el" href="twi__slave__driver_8c-source.html#l00162">TWI_SlaveAddressMatchHandler()</a>, <a class="el" href="twi__slave__driver_8c-source.html#l00214">TWI_SlaveReadHandler()</a>, <a class="el" href="twi__slave__driver_8c-source.html#l00245">TWI_SlaveWriteHandler()</a>, and <a class="el" href="twi__example_8c-source.html#l00077">TWIC_SlaveProcessData()</a>.</p>

</div>
</div><p>
<a class="anchor" name="9b0180363d5eb61e75e9a336b8196ecd"></a><!-- doxytag: member="twi_example.c::twic_status_reg" ref="9b0180363d5eb61e75e9a336b8196ecd" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t <a class="el" href="twi__slave__driver_8c.html#9b0180363d5eb61e75e9a336b8196ecd">twic_status_reg</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="twi__example_8c-source.html#l00057">57</a> of file <a class="el" href="twi__example_8c-source.html">twi_example.c</a>.</p>

<p>Referenced by <a class="el" href="twi__slave__driver_8c-source.html#l00116">TWI_process()</a>, <a class="el" href="twi__slave__driver_8c-source.html#l00199">TWI_SlaveDataHandler()</a>, and <a class="el" href="twi__slave__driver_8c-source.html#l00245">TWI_SlaveWriteHandler()</a>.</p>

</div>
</div><p>
<a class="anchor" name="3701bb8856f53ab26fc694201fde9033"></a><!-- doxytag: member="twi_example.c::twiSlave" ref="3701bb8856f53ab26fc694201fde9033" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structTWI__Slave.html">TWI_Slave_t</a> <a class="el" href="twi__example_8c.html#3701bb8856f53ab26fc694201fde9033">twiSlave</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
TWI slave module. 
<p>Definition at line <a class="el" href="twi__example_8c-source.html#l00070">70</a> of file <a class="el" href="twi__example_8c-source.html">twi_example.c</a>.</p>

</div>
</div><p>
</div>
<html>
 <head>
  <meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
  <title>@DOC_TITLE@</title>
  <link href="doxygen.css" rel="stylesheet" type="text/css">
</head>
<body>

<table width="100%" height="10%" bgcolor="#FFFFFF">
  <tr>
    <td colspan="6" height="1" background="blue.gif"></td>
  </tr>

  <tr>
    <td colspan="6">
    <address style="align: right;"><small>
Generated on Tue Jan 19 18:42:00 2010 for AVR1320: True 400kHz operation for TWI slave by <a href="http://www.doxygen.org/index.html"><img src="doxygen.png" alt="doxygen" align="middle" border=0></a> 1.5.8</small></address>
    </td>
  </tr>

</table>
