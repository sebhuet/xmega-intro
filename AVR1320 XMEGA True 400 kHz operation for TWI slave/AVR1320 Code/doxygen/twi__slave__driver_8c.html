<html>
 <head>
  <meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
  <title>@DOC_TITLE@</title>
  <link href="doxygen.css" rel="stylesheet" type="text/css">
</head>
<body>

<table width="100%" height="10%" bgcolor="#FFFFFF">
  <tr>
    <td colspan="2"><p><A href=http://www.atmel.com ><img src="atmel.jpg"/ border=0></A></p><br /></td>
    <td colspan="2"> <strong><font face="Helvetica" color="#000000" size="+3">Xmega Application Note</font></strong></td>
    <td colspan="2"><p><A href=http://www.atmel.com/products/AVR><img src="AVR_logo_blue.gif"/ border=0></A></p><br /></td>
  </tr>
  <tr>
    <td colspan="6" height="1" background="blue.gif"></td>
  </tr>
</table>
<!-- Generated by Doxygen 1.5.8 -->
<div class="contents">
<h1>twi_slave_driver.c File Reference</h1>XMEGA TWI slave driver source file.  
<a href="#_details">More...</a>
<p>
<code>#include &quot;<a class="el" href="twi__slave__driver_8h-source.html">twi_slave_driver.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="clksys__driver_8h-source.html">clksys_driver.h</a>&quot;</code><br>

<p>
<div class="dynheader">
Include dependency graph for twi_slave_driver.c:</div>
<div class="dynsection">
<p><center><img src="twi__slave__driver_8c__incl.png" border="0" usemap="#twi_slave_driver.c_map" alt=""></center>
<map name="twi_slave_driver.c_map">
<area shape="rect" href="twi__slave__driver_8h.html" title="XMEGA TWI slave driver header file." alt="" coords="5,80,136,107"><area shape="rect" href="clksys__driver_8h.html" title="XMEGA Clock System driver header file." alt="" coords="160,80,269,107"><area shape="rect" href="avr__compiler_8h.html" title="AVR compiler." alt="" coords="88,155,197,181"></map>
</div>

<p>
<a href="twi__slave__driver_8c-source.html">Go to the source code of this file.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="twi__slave__driver_8c.html#efb04ec5f3a4794c210a99bb96385570">TWI_process</a> (<a class="el" href="structTWI__Slave.html">TWI_Slave_t</a> *twi)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Process TWI command.  <a href="#efb04ec5f3a4794c210a99bb96385570"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="twi__slave__driver_8c.html#da072f7590f8a8c4b158891b0dcd33ec">TWI_SlaveAddressMatchHandler</a> (<a class="el" href="structTWI__Slave.html">TWI_Slave_t</a> *twi)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">TWI address match interrupt handler.  <a href="#da072f7590f8a8c4b158891b0dcd33ec"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="twi__slave__driver_8c.html#3aad0def0561cf7bbeb8fad7ebf4fb7f">TWI_SlaveDataHandler</a> (<a class="el" href="structTWI__Slave.html">TWI_Slave_t</a> *twi)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">TWI data interrupt handler.  <a href="#3aad0def0561cf7bbeb8fad7ebf4fb7f"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="twi__slave__driver_8c.html#14b9327d32373a2481e23bec041cbd7e">TWI_SlaveInitializeDriver</a> (<a class="el" href="structTWI__Slave.html">TWI_Slave_t</a> *twi, TWI_t *module, void(*processDataFunction)(void))</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Initalizes TWI slave driver structure.  <a href="#14b9327d32373a2481e23bec041cbd7e"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="twi__slave__driver_8c.html#7516e604cb0aacddd8d1016a54039752">TWI_SlaveInitializeModule</a> (<a class="el" href="structTWI__Slave.html">TWI_Slave_t</a> *twi, uint8_t address, TWI_SLAVE_INTLVL_t intLevel)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Initialize the TWI module.  <a href="#7516e604cb0aacddd8d1016a54039752"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="twi__slave__driver_8c.html#d48293bf279707867535d057473f18b7">TWI_SlaveReadHandler</a> (<a class="el" href="structTWI__Slave.html">TWI_Slave_t</a> *twi)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">TWI slave read interrupt handler.  <a href="#d48293bf279707867535d057473f18b7"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="twi__slave__driver_8c.html#9036345d0182f2e647d9145fa710e20b">TWI_SlaveStopHandler</a> (<a class="el" href="structTWI__Slave.html">TWI_Slave_t</a> *twi)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">TWI stop condition interrupt handler.  <a href="#9036345d0182f2e647d9145fa710e20b"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="twi__slave__driver_8c.html#b9b7fbb48160ccaf6faf33bb9c98396f">TWI_SlaveTransactionFinished</a> (<a class="el" href="structTWI__Slave.html">TWI_Slave_t</a> *twi, uint8_t result)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">TWI transaction finished function.  <a href="#b9b7fbb48160ccaf6faf33bb9c98396f"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="twi__slave__driver_8c.html#772668c5ff7c19f0fab6c9f88ed0a5dd">TWI_SlaveWriteHandler</a> (<a class="el" href="structTWI__Slave.html">TWI_Slave_t</a> *twi)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">TWI slave write interrupt handler.  <a href="#772668c5ff7c19f0fab6c9f88ed0a5dd"></a><br></td></tr>
<tr><td colspan="2"><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">uint8_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="twi__slave__driver_8c.html#0845f2c1dee5db950bc72fc913368e2f">twi_data</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">uint8_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="twi__slave__driver_8c.html#2982dac04be2fac74a31fb4607a947c8">twic_data_reg</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">uint8_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="twi__slave__driver_8c.html#9b0180363d5eb61e75e9a336b8196ecd">twic_status_reg</a></td></tr>

</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
XMEGA TWI slave driver source file. 
<p>
<dl class="user" compact><dt><b>Application note:</b></dt><dd>AVR1320: True 400kHz operation for TWI slave</dd></dl>
<dl class="user" compact><dt><b>Documentation</b></dt><dd>For comprehensive code documentation, supported compilers, compiler settings and supported devices see readme.html</dd></dl>
<dl class="author" compact><dt><b>Author:</b></dt><dd>Atmel Corporation: <a href="http://www.atmel.com">http://www.atmel.com</a> <br>
 Support email: <a href="mailto:avr@atmel.com">avr@atmel.com</a></dd></dl>
Copyright (c) 2009 Atmel Corporation. All rights reserved.<p>
Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:<p>
1. Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.<p>
2. Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.<p>
3. The name of Atmel may not be used to endorse or promote products derived from this software without specific prior written permission.<p>
4. This software may only be redistributed and used in connection with an Atmel AVR product.<p>
THIS SOFTWARE IS PROVIDED BY ATMEL "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT ARE EXPRESSLY AND SPECIFICALLY DISCLAIMED. IN NO EVENT SHALL ATMEL BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE. 
<p>Definition in file <a class="el" href="twi__slave__driver_8c-source.html">twi_slave_driver.c</a>.</p>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="efb04ec5f3a4794c210a99bb96385570"></a><!-- doxytag: member="twi_slave_driver.c::TWI_process" ref="efb04ec5f3a4794c210a99bb96385570" args="(TWI_Slave_t *twi)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TWI_process           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structTWI__Slave.html">TWI_Slave_t</a> *&nbsp;</td>
          <td class="paramname"> <em>twi</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Process TWI command. 
<p>
This function is called out of ISR to process TWI command.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>twi</em>&nbsp;</td><td>The TWI_Slave_t struct instance. </td></tr>
  </table>
</dl>

<p>
&lt; Clear ACKACT 
<p>Definition at line <a class="el" href="twi__slave__driver_8c-source.html#l00116">116</a> of file <a class="el" href="twi__slave__driver_8c-source.html">twi_slave_driver.c</a>.</p>

<p>References <a class="el" href="twi__slave__driver_8h-source.html#l00081">TWI_Slave::bytesReceived</a>, <a class="el" href="twi__slave__driver_8h-source.html#l00082">TWI_Slave::bytesSent</a>, <a class="el" href="twi__slave__driver_8h-source.html#l00077">TWI_Slave::interface</a>, <a class="el" href="twi__slave__driver_8h-source.html#l00084">TWI_Slave::result</a>, <a class="el" href="twi__slave__driver_8h-source.html#l00083">TWI_Slave::status</a>, <a class="el" href="twi__slave__driver_8c-source.html#l00162">TWI_SlaveAddressMatchHandler()</a>, <a class="el" href="twi__slave__driver_8c-source.html#l00199">TWI_SlaveDataHandler()</a>, <a class="el" href="twi__slave__driver_8c-source.html#l00182">TWI_SlaveStopHandler()</a>, <a class="el" href="twi__slave__driver_8c-source.html#l00274">TWI_SlaveTransactionFinished()</a>, <a class="el" href="twi__example_8c-source.html#l00057">twic_status_reg</a>, <a class="el" href="twi__slave__driver_8h-source.html#l00060">TWIS_RESULT_BUS_ERROR</a>, <a class="el" href="twi__slave__driver_8h-source.html#l00061">TWIS_RESULT_FAIL</a>, <a class="el" href="twi__slave__driver_8h-source.html#l00059">TWIS_RESULT_TRANSMIT_COLLISION</a>, and <a class="el" href="twi__slave__driver_8h-source.html#l00051">TWIS_STATUS_READY</a>.</p>

<p>Referenced by <a class="el" href="twi__example_8c-source.html#l00129">ISR()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00117"></a>00117 {
<a name="l00118"></a>00118    <span class="comment">//static uint8_t sent_NACK = 0;      //!&lt; Holds whether NACK has been transmitted</span>
<a name="l00119"></a>00119    uint8_t currentStatus;
<a name="l00120"></a>00120    currentStatus = <a class="code" href="twi__example_8c.html#9b0180363d5eb61e75e9a336b8196ecd">twic_status_reg</a>;
<a name="l00121"></a>00121 
<a name="l00122"></a>00122    twi-&gt;<a class="code" href="structTWI__Slave.html#77840b2d29e959498be84cc3bec0cd22">interface</a>-&gt;SLAVE.CTRLB &amp;= ~TWI_SLAVE_ACKACT_bm; 
<a name="l00123"></a>00123 
<a name="l00124"></a>00124    <span class="comment">/* If bus error. */</span>
<a name="l00125"></a>00125    <span class="keywordflow">if</span> (currentStatus &amp; TWI_SLAVE_BUSERR_bm) {
<a name="l00126"></a>00126       twi-&gt;<a class="code" href="structTWI__Slave.html#35d1088ea403c9811886cc3a454d20ff">bytesReceived</a> = 0;
<a name="l00127"></a>00127       twi-&gt;<a class="code" href="structTWI__Slave.html#e44adb76a49e3ecca8542d10a1d453f8">bytesSent</a> = 0;
<a name="l00128"></a>00128       twi-&gt;<a class="code" href="structTWI__Slave.html#38f52b1274d890275ae25f68d289c8d8">result</a> = <a class="code" href="twi__slave__driver_8h.html#e4209c180fb129f523c8ae18315efc12ce631c3c42041eecb31faad3d44ccc02">TWIS_RESULT_BUS_ERROR</a>;
<a name="l00129"></a>00129       twi-&gt;<a class="code" href="structTWI__Slave.html#f5c33c2e305df38d283d66cdd92d8024">status</a> = <a class="code" href="twi__slave__driver_8h.html#29a0dd867f9750813df434b03a538243">TWIS_STATUS_READY</a>;
<a name="l00130"></a>00130    }
<a name="l00131"></a>00131    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (currentStatus &amp; TWI_SLAVE_COLL_bm) {
<a name="l00132"></a>00132       <span class="comment">/* If transmit collision. */</span>
<a name="l00133"></a>00133       twi-&gt;<a class="code" href="structTWI__Slave.html#35d1088ea403c9811886cc3a454d20ff">bytesReceived</a> = 0;
<a name="l00134"></a>00134       twi-&gt;<a class="code" href="structTWI__Slave.html#e44adb76a49e3ecca8542d10a1d453f8">bytesSent</a> = 0;
<a name="l00135"></a>00135       twi-&gt;<a class="code" href="structTWI__Slave.html#38f52b1274d890275ae25f68d289c8d8">result</a> = <a class="code" href="twi__slave__driver_8h.html#e4209c180fb129f523c8ae18315efc12dbbf8ba327cbb8f83185c7729b7ea4f2">TWIS_RESULT_TRANSMIT_COLLISION</a>;
<a name="l00136"></a>00136       twi-&gt;<a class="code" href="structTWI__Slave.html#f5c33c2e305df38d283d66cdd92d8024">status</a> = <a class="code" href="twi__slave__driver_8h.html#29a0dd867f9750813df434b03a538243">TWIS_STATUS_READY</a>;
<a name="l00137"></a>00137    }
<a name="l00138"></a>00138    <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((currentStatus &amp; TWI_SLAVE_APIF_bm) &amp;&amp; (currentStatus &amp; TWI_SLAVE_AP_bm)) {
<a name="l00139"></a>00139       <span class="comment">/* If address match. */</span>
<a name="l00140"></a>00140       <a class="code" href="twi__slave__driver_8c.html#da072f7590f8a8c4b158891b0dcd33ec" title="TWI address match interrupt handler.">TWI_SlaveAddressMatchHandler</a>(twi);        
<a name="l00141"></a>00141    }
<a name="l00142"></a>00142    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (currentStatus &amp; TWI_SLAVE_APIF_bm) {
<a name="l00143"></a>00143       <span class="comment">/* If stop (only enabled through slave read transaction). */</span>        
<a name="l00144"></a>00144       <a class="code" href="twi__slave__driver_8c.html#9036345d0182f2e647d9145fa710e20b" title="TWI stop condition interrupt handler.">TWI_SlaveStopHandler</a>(twi);
<a name="l00145"></a>00145    }
<a name="l00146"></a>00146    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (currentStatus &amp; TWI_SLAVE_DIF_bm) {
<a name="l00147"></a>00147       <span class="comment">/* If data interrupt. */</span>     
<a name="l00148"></a>00148       <a class="code" href="twi__slave__driver_8c.html#3aad0def0561cf7bbeb8fad7ebf4fb7f" title="TWI data interrupt handler.">TWI_SlaveDataHandler</a>(twi);
<a name="l00149"></a>00149    }
<a name="l00150"></a>00150    <span class="keywordflow">else</span> {
<a name="l00151"></a>00151       <span class="comment">/* If unexpected state. */</span>
<a name="l00152"></a>00152       <a class="code" href="twi__slave__driver_8c.html#b9b7fbb48160ccaf6faf33bb9c98396f" title="TWI transaction finished function.">TWI_SlaveTransactionFinished</a>(twi, <a class="code" href="twi__slave__driver_8h.html#e4209c180fb129f523c8ae18315efc12f3b4529c8dce92f5902d00a0cc6209ec">TWIS_RESULT_FAIL</a>);
<a name="l00153"></a>00153    }
<a name="l00154"></a>00154 }
</pre></div>
<p>

<p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dynsection">
<p><center><img src="twi__slave__driver_8c_efb04ec5f3a4794c210a99bb96385570_cgraph.png" border="0" usemap="#twi__slave__driver_8c_efb04ec5f3a4794c210a99bb96385570_cgraph_map" alt=""></center>
<map name="twi__slave__driver_8c_efb04ec5f3a4794c210a99bb96385570_cgraph_map">
<area shape="rect" href="twi__slave__driver_8c.html#da072f7590f8a8c4b158891b0dcd33ec" title="TWI address match interrupt handler." alt="" coords="157,5,379,32"><area shape="rect" href="twi__slave__driver_8c.html#3aad0def0561cf7bbeb8fad7ebf4fb7f" title="TWI data interrupt handler." alt="" coords="187,56,349,83"><area shape="rect" href="twi__slave__driver_8c.html#b9b7fbb48160ccaf6faf33bb9c98396f" title="TWI transaction finished function." alt="" coords="644,107,852,133"><area shape="rect" href="twi__slave__driver_8c.html#9036345d0182f2e647d9145fa710e20b" title="TWI stop condition interrupt handler." alt="" coords="429,157,592,184"><area shape="rect" href="twi__slave__driver_8c.html#d48293bf279707867535d057473f18b7" title="TWI slave read interrupt handler." alt="" coords="428,5,593,32"><area shape="rect" href="twi__slave__driver_8c.html#772668c5ff7c19f0fab6c9f88ed0a5dd" title="TWI slave write interrupt handler." alt="" coords="428,56,593,83"></map>
</div>

</div>
</div><p>
<a class="anchor" name="da072f7590f8a8c4b158891b0dcd33ec"></a><!-- doxytag: member="twi_slave_driver.c::TWI_SlaveAddressMatchHandler" ref="da072f7590f8a8c4b158891b0dcd33ec" args="(TWI_Slave_t *twi)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void TWI_SlaveAddressMatchHandler           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structTWI__Slave.html">TWI_Slave_t</a> *&nbsp;</td>
          <td class="paramname"> <em>twi</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
TWI address match interrupt handler. 
<p>
Prepares TWI module for transaction when an address match occures.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>twi</em>&nbsp;</td><td>The TWI_Slave_t struct instance. </td></tr>
  </table>
</dl>

<p>Definition at line <a class="el" href="twi__slave__driver_8c-source.html#l00162">162</a> of file <a class="el" href="twi__slave__driver_8c-source.html">twi_slave_driver.c</a>.</p>

<p>References <a class="el" href="twi__slave__driver_8h-source.html#l00081">TWI_Slave::bytesReceived</a>, <a class="el" href="twi__slave__driver_8h-source.html#l00082">TWI_Slave::bytesSent</a>, <a class="el" href="twi__slave__driver_8h-source.html#l00077">TWI_Slave::interface</a>, <a class="el" href="twi__slave__driver_8h-source.html#l00084">TWI_Slave::result</a>, <a class="el" href="twi__slave__driver_8h-source.html#l00080">TWI_Slave::sendData</a>, <a class="el" href="twi__slave__driver_8h-source.html#l00083">TWI_Slave::status</a>, <a class="el" href="twi__example_8c-source.html#l00060">twic_data_reg</a>, <a class="el" href="twi__slave__driver_8h-source.html#l00056">TWIS_RESULT_UNKNOWN</a>, and <a class="el" href="twi__slave__driver_8h-source.html#l00052">TWIS_STATUS_BUSY</a>.</p>

<p>Referenced by <a class="el" href="twi__slave__driver_8c-source.html#l00116">TWI_process()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00163"></a>00163 {
<a name="l00164"></a>00164    twi-&gt;<a class="code" href="structTWI__Slave.html#f5c33c2e305df38d283d66cdd92d8024">status</a> = <a class="code" href="twi__slave__driver_8h.html#72007cf9dc0aa3fc2c8ff81115d3a425">TWIS_STATUS_BUSY</a>;
<a name="l00165"></a>00165    twi-&gt;<a class="code" href="structTWI__Slave.html#38f52b1274d890275ae25f68d289c8d8">result</a> = <a class="code" href="twi__slave__driver_8h.html#e4209c180fb129f523c8ae18315efc124eb04579513e5936c7bcb2776956ff1f">TWIS_RESULT_UNKNOWN</a>;
<a name="l00166"></a>00166 
<a name="l00167"></a>00167    <span class="comment">/* Disable stop interrupt. */</span>
<a name="l00168"></a>00168    uint8_t currentCtrlA = twi-&gt;<a class="code" href="structTWI__Slave.html#77840b2d29e959498be84cc3bec0cd22">interface</a>-&gt;SLAVE.CTRLA;
<a name="l00169"></a>00169    twi-&gt;<a class="code" href="structTWI__Slave.html#77840b2d29e959498be84cc3bec0cd22">interface</a>-&gt;SLAVE.CTRLA = currentCtrlA &amp; ~TWI_SLAVE_PIEN_bm;
<a name="l00170"></a>00170 
<a name="l00171"></a>00171    twi-&gt;<a class="code" href="structTWI__Slave.html#35d1088ea403c9811886cc3a454d20ff">bytesReceived</a> = 0;
<a name="l00172"></a>00172    twi-&gt;<a class="code" href="structTWI__Slave.html#e44adb76a49e3ecca8542d10a1d453f8">bytesSent</a> = 0;
<a name="l00173"></a>00173 
<a name="l00174"></a>00174    <span class="comment">//init second byte to write</span>
<a name="l00175"></a>00175    <a class="code" href="twi__example_8c.html#2982dac04be2fac74a31fb4607a947c8">twic_data_reg</a> = twi-&gt;<a class="code" href="structTWI__Slave.html#ac95534c65dbda49b778a3a05456682d">sendData</a>[0];    
<a name="l00176"></a>00176 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="3aad0def0561cf7bbeb8fad7ebf4fb7f"></a><!-- doxytag: member="twi_slave_driver.c::TWI_SlaveDataHandler" ref="3aad0def0561cf7bbeb8fad7ebf4fb7f" args="(TWI_Slave_t *twi)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void TWI_SlaveDataHandler           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structTWI__Slave.html">TWI_Slave_t</a> *&nbsp;</td>
          <td class="paramname"> <em>twi</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
TWI data interrupt handler. 
<p>
Calls the appropriate slave read or write handler.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>twi</em>&nbsp;</td><td>The TWI_Slave_t struct instance. </td></tr>
  </table>
</dl>

<p>Definition at line <a class="el" href="twi__slave__driver_8c-source.html#l00199">199</a> of file <a class="el" href="twi__slave__driver_8c-source.html">twi_slave_driver.c</a>.</p>

<p>References <a class="el" href="twi__slave__driver_8c-source.html#l00214">TWI_SlaveReadHandler()</a>, <a class="el" href="twi__slave__driver_8c-source.html#l00245">TWI_SlaveWriteHandler()</a>, and <a class="el" href="twi__example_8c-source.html#l00057">twic_status_reg</a>.</p>

<p>Referenced by <a class="el" href="twi__slave__driver_8c-source.html#l00116">TWI_process()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00200"></a>00200 {       
<a name="l00201"></a>00201    <span class="keywordflow">if</span> (<a class="code" href="twi__example_8c.html#9b0180363d5eb61e75e9a336b8196ecd">twic_status_reg</a> &amp; TWI_SLAVE_DIR_bm) {
<a name="l00202"></a>00202       <a class="code" href="twi__slave__driver_8c.html#772668c5ff7c19f0fab6c9f88ed0a5dd" title="TWI slave write interrupt handler.">TWI_SlaveWriteHandler</a>(twi);               
<a name="l00203"></a>00203    } <span class="keywordflow">else</span> {
<a name="l00204"></a>00204       <a class="code" href="twi__slave__driver_8c.html#d48293bf279707867535d057473f18b7" title="TWI slave read interrupt handler.">TWI_SlaveReadHandler</a>(twi);          
<a name="l00205"></a>00205    }
<a name="l00206"></a>00206 }
</pre></div>
<p>

<p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dynsection">
<p><center><img src="twi__slave__driver_8c_3aad0def0561cf7bbeb8fad7ebf4fb7f_cgraph.png" border="0" usemap="#twi__slave__driver_8c_3aad0def0561cf7bbeb8fad7ebf4fb7f_cgraph_map" alt=""></center>
<map name="twi__slave__driver_8c_3aad0def0561cf7bbeb8fad7ebf4fb7f_cgraph_map">
<area shape="rect" href="twi__slave__driver_8c.html#d48293bf279707867535d057473f18b7" title="TWI slave read interrupt handler." alt="" coords="220,5,385,32"><area shape="rect" href="twi__slave__driver_8c.html#772668c5ff7c19f0fab6c9f88ed0a5dd" title="TWI slave write interrupt handler." alt="" coords="220,56,385,83"><area shape="rect" href="twi__slave__driver_8c.html#b9b7fbb48160ccaf6faf33bb9c98396f" title="TWI transaction finished function." alt="" coords="436,56,644,83"></map>
</div>

</div>
</div><p>
<a class="anchor" name="14b9327d32373a2481e23bec041cbd7e"></a><!-- doxytag: member="twi_slave_driver.c::TWI_SlaveInitializeDriver" ref="14b9327d32373a2481e23bec041cbd7e" args="(TWI_Slave_t *twi, TWI_t *module, void(*processDataFunction)(void))" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TWI_SlaveInitializeDriver           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structTWI__Slave.html">TWI_Slave_t</a> *&nbsp;</td>
          <td class="paramname"> <em>twi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">TWI_t *&nbsp;</td>
          <td class="paramname"> <em>module</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void(*)(void)&nbsp;</td>
          <td class="paramname"> <em>processDataFunction</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Initalizes TWI slave driver structure. 
<p>
Initialize the instance of the TWI Slave and set the appropriate values.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>twi</em>&nbsp;</td><td>The TWI_Slave_t struct instance. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>module</em>&nbsp;</td><td>Pointer to the TWI module. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>processDataFunction</em>&nbsp;</td><td>Pointer to the function that handles incoming data. </td></tr>
  </table>
</dl>

<p>Definition at line <a class="el" href="twi__slave__driver_8c-source.html#l00068">68</a> of file <a class="el" href="twi__slave__driver_8c-source.html">twi_slave_driver.c</a>.</p>

<p>References <a class="el" href="twi__slave__driver_8h-source.html#l00085">TWI_Slave::abort</a>, <a class="el" href="twi__slave__driver_8h-source.html#l00081">TWI_Slave::bytesReceived</a>, <a class="el" href="twi__slave__driver_8h-source.html#l00082">TWI_Slave::bytesSent</a>, <a class="el" href="clksys__driver_8c-source.html#l00174">CLKSYS_Disable()</a>, <a class="el" href="clksys__driver_8h-source.html#l00081">CLKSYS_Enable</a>, <a class="el" href="clksys__driver_8h-source.html#l00094">CLKSYS_IsReady</a>, <a class="el" href="clksys__driver_8c-source.html#l00212">CLKSYS_Main_ClockSource_Select()</a>, <a class="el" href="twi__slave__driver_8h-source.html#l00077">TWI_Slave::interface</a>, <a class="el" href="structTWI__Slave.html#3b1cd58ff7d3c1ab6112265b652e4356">TWI_Slave::Process_Data</a>, <a class="el" href="twi__slave__driver_8h-source.html#l00084">TWI_Slave::result</a>, <a class="el" href="twi__slave__driver_8h-source.html#l00083">TWI_Slave::status</a>, <a class="el" href="twi__slave__driver_8h-source.html#l00056">TWIS_RESULT_UNKNOWN</a>, and <a class="el" href="twi__slave__driver_8h-source.html#l00051">TWIS_STATUS_READY</a>.</p>

<p>Referenced by <a class="el" href="twi__example_8c-source.html#l00095">main()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00071"></a>00071 {
<a name="l00072"></a>00072    twi-&gt;<a class="code" href="structTWI__Slave.html#77840b2d29e959498be84cc3bec0cd22">interface</a> = module;
<a name="l00073"></a>00073    twi-&gt;<a class="code" href="structTWI__Slave.html#3b1cd58ff7d3c1ab6112265b652e4356">Process_Data</a> = processDataFunction;
<a name="l00074"></a>00074    twi-&gt;<a class="code" href="structTWI__Slave.html#35d1088ea403c9811886cc3a454d20ff">bytesReceived</a> = 0;
<a name="l00075"></a>00075    twi-&gt;<a class="code" href="structTWI__Slave.html#e44adb76a49e3ecca8542d10a1d453f8">bytesSent</a> = 0;
<a name="l00076"></a>00076    twi-&gt;<a class="code" href="structTWI__Slave.html#f5c33c2e305df38d283d66cdd92d8024">status</a> = <a class="code" href="twi__slave__driver_8h.html#29a0dd867f9750813df434b03a538243">TWIS_STATUS_READY</a>;
<a name="l00077"></a>00077    twi-&gt;<a class="code" href="structTWI__Slave.html#38f52b1274d890275ae25f68d289c8d8">result</a> = <a class="code" href="twi__slave__driver_8h.html#e4209c180fb129f523c8ae18315efc124eb04579513e5936c7bcb2776956ff1f">TWIS_RESULT_UNKNOWN</a>;
<a name="l00078"></a>00078    twi-&gt;<a class="code" href="structTWI__Slave.html#9f82420e39d70716410a66dcd3c22c1b">abort</a> = <span class="keyword">false</span>;
<a name="l00079"></a>00079           
<a name="l00080"></a>00080    <a class="code" href="clksys__driver_8h.html#0894c64562c3b1c309bab97a83382267" title="This macro enables the selected oscillator.">CLKSYS_Enable</a>( OSC_RC32MEN_bm );
<a name="l00081"></a>00081    <span class="keywordflow">do</span> {} <span class="keywordflow">while</span> ( <a class="code" href="clksys__driver_8h.html#2cd92dbb89e4051b9385a61273d19dc6" title="This macro check if selected oscillator is ready.">CLKSYS_IsReady</a>( OSC_RC32MRDY_bm ) == 0 );
<a name="l00082"></a>00082         
<a name="l00083"></a>00083    <span class="comment">/* 32MHz Internal RC*/</span>
<a name="l00084"></a>00084    <a class="code" href="clksys__driver_8c.html#1e46c4a8f01a83d4e4747d32d113e7e2" title="This function selects the main system clock source.">CLKSYS_Main_ClockSource_Select</a>( CLK_SCLKSEL_RC32M_gc );
<a name="l00085"></a>00085         
<a name="l00086"></a>00086    <a class="code" href="clksys__driver_8c.html#31b1ca1994b6a687974a119d1ad8008c" title="This function disables the selected oscillator.">CLKSYS_Disable</a>( OSC_RC2MEN_bm | OSC_RC32KEN_bm );    
<a name="l00087"></a>00087 }
</pre></div>
<p>

<p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dynsection">
<p><center><img src="twi__slave__driver_8c_14b9327d32373a2481e23bec041cbd7e_cgraph.png" border="0" usemap="#twi__slave__driver_8c_14b9327d32373a2481e23bec041cbd7e_cgraph_map" alt=""></center>
<map name="twi__slave__driver_8c_14b9327d32373a2481e23bec041cbd7e_cgraph_map">
<area shape="rect" href="clksys__driver_8c.html#31b1ca1994b6a687974a119d1ad8008c" title="This function disables the selected oscillator." alt="" coords="284,5,409,32"><area shape="rect" href="clksys__driver_8c.html#1e46c4a8f01a83d4e4747d32d113e7e2" title="This function selects the main system clock source." alt="" coords="228,56,465,83"><area shape="rect" href="clksys__driver_8c.html#ad4e162434c2cc7e0087bbc0ddfe266c" title="CCP write helper function written in assembly." alt="" coords="516,56,596,83"></map>
</div>

</div>
</div><p>
<a class="anchor" name="7516e604cb0aacddd8d1016a54039752"></a><!-- doxytag: member="twi_slave_driver.c::TWI_SlaveInitializeModule" ref="7516e604cb0aacddd8d1016a54039752" args="(TWI_Slave_t *twi, uint8_t address, TWI_SLAVE_INTLVL_t intLevel)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TWI_SlaveInitializeModule           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structTWI__Slave.html">TWI_Slave_t</a> *&nbsp;</td>
          <td class="paramname"> <em>twi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&nbsp;</td>
          <td class="paramname"> <em>address</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">TWI_SLAVE_INTLVL_t&nbsp;</td>
          <td class="paramname"> <em>intLevel</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Initialize the TWI module. 
<p>
Enables interrupts on address recognition and data available. Remember to enable interrupts globally from the main application.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>twi</em>&nbsp;</td><td>The TWI_Slave_t struct instance. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>address</em>&nbsp;</td><td>Slave address for this module. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>intLevel</em>&nbsp;</td><td>Interrupt level for the TWI slave interrupt handler. </td></tr>
  </table>
</dl>

<p>Definition at line <a class="el" href="twi__slave__driver_8c-source.html#l00099">99</a> of file <a class="el" href="twi__slave__driver_8c-source.html">twi_slave_driver.c</a>.</p>

<p>References <a class="el" href="twi__slave__driver_8h-source.html#l00077">TWI_Slave::interface</a>.</p>

<p>Referenced by <a class="el" href="twi__example_8c-source.html#l00095">main()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00102"></a>00102 {
<a name="l00103"></a>00103    twi-&gt;<a class="code" href="structTWI__Slave.html#77840b2d29e959498be84cc3bec0cd22">interface</a>-&gt;SLAVE.CTRLA = intLevel |
<a name="l00104"></a>00104                                  TWI_SLAVE_DIEN_bm |
<a name="l00105"></a>00105                                  TWI_SLAVE_APIEN_bm |
<a name="l00106"></a>00106                                  TWI_SLAVE_ENABLE_bm;
<a name="l00107"></a>00107    twi-&gt;<a class="code" href="structTWI__Slave.html#77840b2d29e959498be84cc3bec0cd22">interface</a>-&gt;SLAVE.ADDR = (address&lt;&lt;1);
<a name="l00108"></a>00108 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="d48293bf279707867535d057473f18b7"></a><!-- doxytag: member="twi_slave_driver.c::TWI_SlaveReadHandler" ref="d48293bf279707867535d057473f18b7" args="(TWI_Slave_t *twi)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void TWI_SlaveReadHandler           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structTWI__Slave.html">TWI_Slave_t</a> *&nbsp;</td>
          <td class="paramname"> <em>twi</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
TWI slave read interrupt handler. 
<p>
Handles TWI slave read transactions and responses.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>twi</em>&nbsp;</td><td>The TWI_Slave_t struct instance. </td></tr>
  </table>
</dl>

<p>Definition at line <a class="el" href="twi__slave__driver_8c-source.html#l00214">214</a> of file <a class="el" href="twi__slave__driver_8c-source.html">twi_slave_driver.c</a>.</p>

<p>References <a class="el" href="twi__slave__driver_8h-source.html#l00081">TWI_Slave::bytesReceived</a>, <a class="el" href="twi__slave__driver_8h-source.html#l00077">TWI_Slave::interface</a>, <a class="el" href="structTWI__Slave.html#3b1cd58ff7d3c1ab6112265b652e4356">TWI_Slave::Process_Data</a>, <a class="el" href="twi__slave__driver_8h-source.html#l00079">TWI_Slave::receivedData</a>, <a class="el" href="twi__example_8c-source.html#l00060">twic_data_reg</a>, and <a class="el" href="twi__slave__driver_8h-source.html#l00066">TWIS_RECEIVE_BUFFER_SIZE</a>.</p>

<p>Referenced by <a class="el" href="twi__slave__driver_8c-source.html#l00199">TWI_SlaveDataHandler()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00215"></a>00215 {
<a name="l00216"></a>00216    <span class="comment">/* Enable stop interrupt. */</span>
<a name="l00217"></a>00217    uint8_t currentCtrlA = twi-&gt;<a class="code" href="structTWI__Slave.html#77840b2d29e959498be84cc3bec0cd22">interface</a>-&gt;SLAVE.CTRLA;
<a name="l00218"></a>00218    twi-&gt;<a class="code" href="structTWI__Slave.html#77840b2d29e959498be84cc3bec0cd22">interface</a>-&gt;SLAVE.CTRLA = currentCtrlA | TWI_SLAVE_PIEN_bm;
<a name="l00219"></a>00219 
<a name="l00220"></a>00220    <span class="comment">/* If free space in buffer.*/</span>
<a name="l00221"></a>00221    <span class="keywordflow">if</span> (twi-&gt;<a class="code" href="structTWI__Slave.html#35d1088ea403c9811886cc3a454d20ff">bytesReceived</a> &lt; <a class="code" href="twi__slave__driver_8h.html#e04807263061939fbe5605b438458fd0">TWIS_RECEIVE_BUFFER_SIZE</a>) {
<a name="l00222"></a>00222       <span class="comment">/* Fetch data */</span>
<a name="l00223"></a>00223       uint8_t data = <a class="code" href="twi__example_8c.html#2982dac04be2fac74a31fb4607a947c8">twic_data_reg</a>;
<a name="l00224"></a>00224       twi-&gt;<a class="code" href="structTWI__Slave.html#8c205728fdea8bcaeaa0f6f889d83d4d">receivedData</a>[twi-&gt;<a class="code" href="structTWI__Slave.html#35d1088ea403c9811886cc3a454d20ff">bytesReceived</a>] = data;
<a name="l00225"></a>00225       <span class="comment">/* Process data. */</span>
<a name="l00226"></a>00226       twi-&gt;<a class="code" href="structTWI__Slave.html#3b1cd58ff7d3c1ab6112265b652e4356">Process_Data</a>();
<a name="l00227"></a>00227       twi-&gt;<a class="code" href="structTWI__Slave.html#35d1088ea403c9811886cc3a454d20ff">bytesReceived</a>++;
<a name="l00228"></a>00228    } <span class="keywordflow">else</span> {
<a name="l00229"></a>00229       <span class="comment">// We will ignore the overshooting packets.</span>
<a name="l00230"></a>00230    }
<a name="l00231"></a>00231         
<a name="l00232"></a>00232    <span class="comment">/* buffer overflow next time*/</span>
<a name="l00233"></a>00233    <span class="keywordflow">if</span>  (!(twi-&gt;<a class="code" href="structTWI__Slave.html#35d1088ea403c9811886cc3a454d20ff">bytesReceived</a> &lt; <a class="code" href="twi__slave__driver_8h.html#e04807263061939fbe5605b438458fd0">TWIS_RECEIVE_BUFFER_SIZE</a>)){
<a name="l00234"></a>00234       twi-&gt;<a class="code" href="structTWI__Slave.html#77840b2d29e959498be84cc3bec0cd22">interface</a>-&gt;SLAVE.CTRLB |= TWI_SLAVE_ACKACT_bm;
<a name="l00235"></a>00235   }
<a name="l00236"></a>00236 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="9036345d0182f2e647d9145fa710e20b"></a><!-- doxytag: member="twi_slave_driver.c::TWI_SlaveStopHandler" ref="9036345d0182f2e647d9145fa710e20b" args="(TWI_Slave_t *twi)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void TWI_SlaveStopHandler           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structTWI__Slave.html">TWI_Slave_t</a> *&nbsp;</td>
          <td class="paramname"> <em>twi</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
TWI stop condition interrupt handler. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>twi</em>&nbsp;</td><td>The TWI_Slave_t struct instance. </td></tr>
  </table>
</dl>

<p>Definition at line <a class="el" href="twi__slave__driver_8c-source.html#l00182">182</a> of file <a class="el" href="twi__slave__driver_8c-source.html">twi_slave_driver.c</a>.</p>

<p>References <a class="el" href="twi__slave__driver_8h-source.html#l00077">TWI_Slave::interface</a>, <a class="el" href="twi__slave__driver_8c-source.html#l00274">TWI_SlaveTransactionFinished()</a>, and <a class="el" href="twi__slave__driver_8h-source.html#l00057">TWIS_RESULT_OK</a>.</p>

<p>Referenced by <a class="el" href="twi__slave__driver_8c-source.html#l00116">TWI_process()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00183"></a>00183 {
<a name="l00184"></a>00184    <span class="comment">/* Disable stop interrupt. */</span>
<a name="l00185"></a>00185    uint8_t currentCtrlA = twi-&gt;<a class="code" href="structTWI__Slave.html#77840b2d29e959498be84cc3bec0cd22">interface</a>-&gt;SLAVE.CTRLA;
<a name="l00186"></a>00186    twi-&gt;<a class="code" href="structTWI__Slave.html#77840b2d29e959498be84cc3bec0cd22">interface</a>-&gt;SLAVE.CTRLA = currentCtrlA &amp; ~TWI_SLAVE_PIEN_bm;
<a name="l00187"></a>00187    uint8_t currentStatus = twi-&gt;<a class="code" href="structTWI__Slave.html#77840b2d29e959498be84cc3bec0cd22">interface</a>-&gt;SLAVE.STATUS;
<a name="l00188"></a>00188    twi-&gt;<a class="code" href="structTWI__Slave.html#77840b2d29e959498be84cc3bec0cd22">interface</a>-&gt;SLAVE.STATUS = currentStatus | TWI_SLAVE_APIF_bm;
<a name="l00189"></a>00189 
<a name="l00190"></a>00190    <a class="code" href="twi__slave__driver_8c.html#b9b7fbb48160ccaf6faf33bb9c98396f" title="TWI transaction finished function.">TWI_SlaveTransactionFinished</a>(twi, <a class="code" href="twi__slave__driver_8h.html#e4209c180fb129f523c8ae18315efc12dbab0894d62d8714955f09f5ef5a6193">TWIS_RESULT_OK</a>);
<a name="l00191"></a>00191 }
</pre></div>
<p>

<p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dynsection">
<p><center><img src="twi__slave__driver_8c_9036345d0182f2e647d9145fa710e20b_cgraph.png" border="0" usemap="#twi__slave__driver_8c_9036345d0182f2e647d9145fa710e20b_cgraph_map" alt=""></center>
<map name="twi__slave__driver_8c_9036345d0182f2e647d9145fa710e20b_cgraph_map">
<area shape="rect" href="twi__slave__driver_8c.html#b9b7fbb48160ccaf6faf33bb9c98396f" title="TWI transaction finished function." alt="" coords="217,5,425,32"></map>
</div>

</div>
</div><p>
<a class="anchor" name="b9b7fbb48160ccaf6faf33bb9c98396f"></a><!-- doxytag: member="twi_slave_driver.c::TWI_SlaveTransactionFinished" ref="b9b7fbb48160ccaf6faf33bb9c98396f" args="(TWI_Slave_t *twi, uint8_t result)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void TWI_SlaveTransactionFinished           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structTWI__Slave.html">TWI_Slave_t</a> *&nbsp;</td>
          <td class="paramname"> <em>twi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&nbsp;</td>
          <td class="paramname"> <em>result</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
TWI transaction finished function. 
<p>
Prepares module for new transaction.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>twi</em>&nbsp;</td><td>The TWI_Slave_t struct instance. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>result</em>&nbsp;</td><td>The result of the transaction. </td></tr>
  </table>
</dl>

<p>Definition at line <a class="el" href="twi__slave__driver_8c-source.html#l00274">274</a> of file <a class="el" href="twi__slave__driver_8c-source.html">twi_slave_driver.c</a>.</p>

<p>References <a class="el" href="twi__slave__driver_8h-source.html#l00084">TWI_Slave::result</a>, <a class="el" href="twi__slave__driver_8h-source.html#l00083">TWI_Slave::status</a>, and <a class="el" href="twi__slave__driver_8h-source.html#l00051">TWIS_STATUS_READY</a>.</p>

<p>Referenced by <a class="el" href="twi__slave__driver_8c-source.html#l00116">TWI_process()</a>, <a class="el" href="twi__slave__driver_8c-source.html#l00182">TWI_SlaveStopHandler()</a>, and <a class="el" href="twi__slave__driver_8c-source.html#l00245">TWI_SlaveWriteHandler()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00275"></a>00275 {
<a name="l00276"></a>00276    twi-&gt;<a class="code" href="structTWI__Slave.html#38f52b1274d890275ae25f68d289c8d8">result</a> = result;
<a name="l00277"></a>00277    twi-&gt;<a class="code" href="structTWI__Slave.html#f5c33c2e305df38d283d66cdd92d8024">status</a> = <a class="code" href="twi__slave__driver_8h.html#29a0dd867f9750813df434b03a538243">TWIS_STATUS_READY</a>;
<a name="l00278"></a>00278 }</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="772668c5ff7c19f0fab6c9f88ed0a5dd"></a><!-- doxytag: member="twi_slave_driver.c::TWI_SlaveWriteHandler" ref="772668c5ff7c19f0fab6c9f88ed0a5dd" args="(TWI_Slave_t *twi)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void TWI_SlaveWriteHandler           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structTWI__Slave.html">TWI_Slave_t</a> *&nbsp;</td>
          <td class="paramname"> <em>twi</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
TWI slave write interrupt handler. 
<p>
Handles TWI slave write transactions and responses.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>twi</em>&nbsp;</td><td>The TWI_Slave_t struct instance. </td></tr>
  </table>
</dl>

<p>Definition at line <a class="el" href="twi__slave__driver_8c-source.html#l00245">245</a> of file <a class="el" href="twi__slave__driver_8c-source.html">twi_slave_driver.c</a>.</p>

<p>References <a class="el" href="twi__slave__driver_8h-source.html#l00082">TWI_Slave::bytesSent</a>, <a class="el" href="twi__slave__driver_8h-source.html#l00080">TWI_Slave::sendData</a>, <a class="el" href="twi__slave__driver_8c-source.html#l00274">TWI_SlaveTransactionFinished()</a>, <a class="el" href="twi__example_8c-source.html#l00060">twic_data_reg</a>, <a class="el" href="twi__example_8c-source.html#l00057">twic_status_reg</a>, <a class="el" href="twi__slave__driver_8h-source.html#l00058">TWIS_RESULT_BUFFER_OVERFLOW</a>, <a class="el" href="twi__slave__driver_8h-source.html#l00057">TWIS_RESULT_OK</a>, and <a class="el" href="twi__slave__driver_8h-source.html#l00067">TWIS_SEND_BUFFER_SIZE</a>.</p>

<p>Referenced by <a class="el" href="twi__slave__driver_8c-source.html#l00199">TWI_SlaveDataHandler()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00246"></a>00246 {
<a name="l00247"></a>00247    <span class="comment">/* If NACK, slave write transaction finished. */</span>
<a name="l00248"></a>00248    <span class="keywordflow">if</span> ((twi-&gt;<a class="code" href="structTWI__Slave.html#e44adb76a49e3ecca8542d10a1d453f8">bytesSent</a> &gt; 0) &amp;&amp; (<a class="code" href="twi__example_8c.html#9b0180363d5eb61e75e9a336b8196ecd">twic_status_reg</a> &amp; TWI_SLAVE_RXACK_bm)) {
<a name="l00249"></a>00249       <span class="comment">//init first byte to write</span>
<a name="l00250"></a>00250       <a class="code" href="twi__example_8c.html#2982dac04be2fac74a31fb4607a947c8">twic_data_reg</a> = twi-&gt;<a class="code" href="structTWI__Slave.html#ac95534c65dbda49b778a3a05456682d">sendData</a>[0];
<a name="l00251"></a>00251       <a class="code" href="twi__slave__driver_8c.html#b9b7fbb48160ccaf6faf33bb9c98396f" title="TWI transaction finished function.">TWI_SlaveTransactionFinished</a>(twi, <a class="code" href="twi__slave__driver_8h.html#e4209c180fb129f523c8ae18315efc12dbab0894d62d8714955f09f5ef5a6193">TWIS_RESULT_OK</a>);
<a name="l00252"></a>00252    }
<a name="l00253"></a>00253    <span class="comment">/* If ACK, master expects more data. */</span>
<a name="l00254"></a>00254    <span class="keywordflow">else</span> {
<a name="l00255"></a>00255       <span class="keywordflow">if</span> (twi-&gt;<a class="code" href="structTWI__Slave.html#e44adb76a49e3ecca8542d10a1d453f8">bytesSent</a> &lt; <a class="code" href="twi__slave__driver_8h.html#9485472cdd2d9d40bbe1a29df42310ab">TWIS_SEND_BUFFER_SIZE</a>) {
<a name="l00256"></a>00256          twi-&gt;<a class="code" href="structTWI__Slave.html#e44adb76a49e3ecca8542d10a1d453f8">bytesSent</a>++;
<a name="l00257"></a>00257          uint8_t data = twi-&gt;<a class="code" href="structTWI__Slave.html#ac95534c65dbda49b778a3a05456682d">sendData</a>[twi-&gt;<a class="code" href="structTWI__Slave.html#e44adb76a49e3ecca8542d10a1d453f8">bytesSent</a>];
<a name="l00258"></a>00258          <a class="code" href="twi__example_8c.html#2982dac04be2fac74a31fb4607a947c8">twic_data_reg</a> = data;                  
<a name="l00259"></a>00259       }
<a name="l00260"></a>00260       <span class="keywordflow">else</span> {
<a name="l00261"></a>00261          <span class="comment">/* If buffer overflow. */</span>
<a name="l00262"></a>00262          <a class="code" href="twi__slave__driver_8c.html#b9b7fbb48160ccaf6faf33bb9c98396f" title="TWI transaction finished function.">TWI_SlaveTransactionFinished</a>(twi, <a class="code" href="twi__slave__driver_8h.html#e4209c180fb129f523c8ae18315efc1241417398cafb1e687678c96d000ca672">TWIS_RESULT_BUFFER_OVERFLOW</a>);
<a name="l00263"></a>00263       }
<a name="l00264"></a>00264    }
<a name="l00265"></a>00265 } 
</pre></div>
<p>

<p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dynsection">
<p><center><img src="twi__slave__driver_8c_772668c5ff7c19f0fab6c9f88ed0a5dd_cgraph.png" border="0" usemap="#twi__slave__driver_8c_772668c5ff7c19f0fab6c9f88ed0a5dd_cgraph_map" alt=""></center>
<map name="twi__slave__driver_8c_772668c5ff7c19f0fab6c9f88ed0a5dd_cgraph_map">
<area shape="rect" href="twi__slave__driver_8c.html#b9b7fbb48160ccaf6faf33bb9c98396f" title="TWI transaction finished function." alt="" coords="223,5,431,32"></map>
</div>

</div>
</div><p>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="0845f2c1dee5db950bc72fc913368e2f"></a><!-- doxytag: member="twi_slave_driver.c::twi_data" ref="0845f2c1dee5db950bc72fc913368e2f" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t <a class="el" href="twi__slave__driver_8c.html#0845f2c1dee5db950bc72fc913368e2f">twi_data</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<a class="anchor" name="2982dac04be2fac74a31fb4607a947c8"></a><!-- doxytag: member="twi_slave_driver.c::twic_data_reg" ref="2982dac04be2fac74a31fb4607a947c8" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t <a class="el" href="twi__slave__driver_8c.html#2982dac04be2fac74a31fb4607a947c8">twic_data_reg</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="twi__example_8c-source.html#l00060">60</a> of file <a class="el" href="twi__example_8c-source.html">twi_example.c</a>.</p>

<p>Referenced by <a class="el" href="twi__slave__driver_8c-source.html#l00162">TWI_SlaveAddressMatchHandler()</a>, <a class="el" href="twi__slave__driver_8c-source.html#l00214">TWI_SlaveReadHandler()</a>, <a class="el" href="twi__slave__driver_8c-source.html#l00245">TWI_SlaveWriteHandler()</a>, and <a class="el" href="twi__example_8c-source.html#l00077">TWIC_SlaveProcessData()</a>.</p>

</div>
</div><p>
<a class="anchor" name="9b0180363d5eb61e75e9a336b8196ecd"></a><!-- doxytag: member="twi_slave_driver.c::twic_status_reg" ref="9b0180363d5eb61e75e9a336b8196ecd" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t <a class="el" href="twi__slave__driver_8c.html#9b0180363d5eb61e75e9a336b8196ecd">twic_status_reg</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="twi__example_8c-source.html#l00057">57</a> of file <a class="el" href="twi__example_8c-source.html">twi_example.c</a>.</p>

<p>Referenced by <a class="el" href="twi__slave__driver_8c-source.html#l00116">TWI_process()</a>, <a class="el" href="twi__slave__driver_8c-source.html#l00199">TWI_SlaveDataHandler()</a>, and <a class="el" href="twi__slave__driver_8c-source.html#l00245">TWI_SlaveWriteHandler()</a>.</p>

</div>
</div><p>
</div>
<html>
 <head>
  <meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
  <title>@DOC_TITLE@</title>
  <link href="doxygen.css" rel="stylesheet" type="text/css">
</head>
<body>

<table width="100%" height="10%" bgcolor="#FFFFFF">
  <tr>
    <td colspan="6" height="1" background="blue.gif"></td>
  </tr>

  <tr>
    <td colspan="6">
    <address style="align: right;"><small>
Generated on Tue Jan 19 18:42:00 2010 for AVR1320: True 400kHz operation for TWI slave by <a href="http://www.doxygen.org/index.html"><img src="doxygen.png" alt="doxygen" align="middle" border=0></a> 1.5.8</small></address>
    </td>
  </tr>

</table>
